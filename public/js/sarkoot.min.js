(function(){
	function jresp(context, res)
	{
		context.trigger('jresp', [res]);
		if (res.message && !context.is('.d-notification'))
		{
			if (window.toastr)
			{
				var toast = toastr[res.is_ok ? 'success' : 'error'](res.message_text || res.message, undefined, {
					"closeButton": true,
					"newestOnTop": true,
					"positionClass": "toast-bottom-right",
				});
			}
			else if (window.iziToast)
			{
				iziToast[res.is_ok ? 'success' : 'error']({ message: res.message_text || res.message});
			}
		}
		if(res.redirect)
		{
			if(res.direct)
			{
				location.href = res.redirect;
			}
			else
			{
				new Statio({
					url : res.redirect
				});
			}
		}
	}
	window.JResp = jresp;
})();
(function(){
	function lijax(context, onFire)
	{
        var back_value = $(context).val() || $(context).attr('data-value');
        if($(context).is(':checkbox'))
        {
            back_value = $(context).is(':checked') ? 1 : 0;
        }
        var Timeout = null;
        var fire = null;
        if($(context).is('form') && !$(context).attr('data-lijax'))
        {
            fire = ['submit'];
        }
        else
        {
            fire = $(context).attr('data-lijax').split(' ') || ['change'];
        }
        for (var i = 0; i < fire.length; i++) {
            if(/^\d+$/.test(fire[i]))
            {
                var Time = fire[i];
                $(context).on('keyup', function(){
                    if(Timeout) clearTimeout(Timeout);
                    Timeout = setTimeout(send, Time);
                });
            }
            else
            {
                $(context).on(fire[i], send);
            }
        }

        function send()
        {
            var href = url.parse(location.href);
            var name = $(context).attr('name') || $(context).attr('data-name');
            if(href.get && href.get[name])
            {
                delete href.get[name];
            }
            var get = url.buildget(href.get);
            href = href.url.replace(/\?(.*)$/, get ? '?' + get : '');
            var action = $(context).attr('href') || $(context).attr('action') || $(context).attr('data-action') || href;
            var method = $(context).attr('data-method') || $(context).attr('method') || 'GET';
            var state = $(context).attr('data-state');
            var value = undefined;
            if($(context).is('form'))
            {
                var Data = new FormData(context);
                var data = {};
				if ($(context).attr('enctype') == 'multipart/form-data' || $('input:file', context).length)
                {
                    data = Data;
                }
                else
                {
                    Data.forEach(function (value, name) {
                        data[name] = /\[.*\]$/.test(name) ? Data.getAll(name) : Data.get(name);
                    });
                }
                state = false;
                $(context).addClass('lijax-sending');
                $('input, select, textarea, button', context).not(':disabled').addClass('lijax-disable').attr('disabled', 'disabled');
                $(context).on('statio:done', function () {
                    $('.lijax-disable', this).removeClass('lijax-disable').removeAttr('disabled')
                    $(this).removeClass('lijax-sending');
                });
            }
            else
            {
                value = $(context).val() || $(context).attr('data-value') || null;
                if($(context).is(':checkbox'))
                {
                    value = $(context).is(':checked') ? 1 : 0;
                }
                if(back_value == value && $(context).is('input, textarea, select') && !onFire) return;
                back_value = value;
                var data = {};
                data[name] = value;
            }
            if ($(context).attr('data-query'))
            {
                var action_query = url.parse(action);
                var data_query = url.parse('?' + $(context).attr('data-query'));
                action_query.get = $.extend(null, (action_query.get || {}), data_query.get);
                action = url.build(action_query);
            }
            var headers = {};
            if ($(context).attr('data-xhrBase'))
            {
                headers = {
                    'Data-xhr-base': $(context).attr('data-xhrBase')
                };
            }
            new Statio({
                type : state ? 'both' : 'render',
                context: context,
                ajax : {
					contentType: $(context).is('form') && ($(context).attr('enctype') == 'multipart/form-data' || $('input:file', context).length) ? false : 'application/x-www-form-urlencoded; charset=UTF-8',
					processData: ($(context).is('form') && ($(context).attr('enctype') == 'multipart/form-data' || $('input:file', context).length)) ? false : true,
                    cache       : false,
                    method : method,
                    data : data,
                    headers: headers
                },
                url : action
            });
            return false;
        }
        if (onFire)
        {
            send();
        }
    }
    window.Lijax = lijax;
})();
(function(){
	var _globals = {
		title : function (value){
			$('title').html(value);
		}
	}

	var _ajax = {
		type : 'GET',
		cache : false
	}

	var _options = {
		object : null,
		title : null,
		ajax : _ajax,
	/**
	 * Send request and change url with response rendering
	 * @default both
	 * both: change url and render response
	 * url: Only send request and chage url without change rendering
	 * render: Only send request and render repsonse without change url
	 * @type {String}
	 */
	 type : 'both',
	/**
	 * dont send any request
	 * @type {Boolean}
	 */
	 fake : false,
	/**
	 * ajax response contetnt
	 * if {fake:true} or {response : notnull} response render this property
	 * @type {[type]}
	 */
	 response : null,
	/**
	 * replace state
	 * @type {Boolean}
	 */
	 replace : false,
	/**
	 * event context
	 * @type {DOM} {jQuery} {Selector string}
	 */
	 context : document
	}

	function statio(custom){
		if(typeof custom != 'object')
		{
			custom = {};
		}

		custom.ajax = $.extend({}, _ajax, custom.ajax);
		custom.ajax.url = custom.url;
		custom.globals = $.extend({}, _globals, custom.globals);
		var options = $.extend({}, _options, custom);

		var response = {
			body : options.response,
			data : {},
		};

		if(!(options.context instanceof jQuery))
		{
			options.context = $(options.context);
		}

		$(document).trigger('statio:global:init', [options.context]);
		options.context.trigger('statio:init');


		var ajax_data = null;
		var ajax_send_url = null;
		if(!options.fake)
		{
			if(!options.ajax.complete)
			{
				options.ajax.complete = ajx_complete;
			}
			var beforeSend = options.ajax.beforeSend;
			options.ajax.beforeSend = function(jqXHR, settings)
			{
				ajax_data = this;
				ajax_send_url = this.url;
				var urlx = url.parse(ajax_send_url);
				if(urlx.get && urlx.get._)
				{
					delete urlx.get._;
				}
            	var get = url.buildget(urlx.get);
            	ajax_send_url = urlx.url.replace(/\?(.*)$/, get ? '?' + get : '');
				beforeSend ? beforeSend.call(this, jqXHR, settings) : null;
			}
			$.ajax(options.ajax);
		}
		else if(options.type != 'url' && response.body)
		{
			response_parse();
			render();
			$(document).trigger('statio:global:done', [options.context]);
			options.context.trigger('statio:done');
		}
		else
		{
			try {
				options.replace
					? history.replaceState(JSON.parse(JSON.stringify(options)), options.title, ajax_send_url || options.url)
					: history.pushState(JSON.parse(JSON.stringify(options)), options.title, ajax_send_url || options.url);
			}
			catch (e) {
				console.error(e);
			}
			$(document).trigger('statio:global:done', [options.context]);
			options.context.trigger('statio:done');
		}

		function ajx_complete(jqXHR, textStatus)
		{
			if(jqXHR.responseJSON)
			{
				response.data = jqXHR.responseJSON;
				$(document).trigger('statio:global:jsonResponse', [options.context, jqXHR.responseJSON, jqXHR]);
				options.context.trigger('statio:jsonResponse', [jqXHR.responseJSON, jqXHR]);
				new JResp(options.context, response.data);
			}
			else
			{
				response.body = jqXHR.responseText;
				response_parse();
				if(textStatus == 'success')
				{
					if (options.type != 'render') {
						try {
							options.response = response;
							options.replace
								? history.replaceState(JSON.parse(JSON.stringify(options)), options.title, ajax_send_url || options.url)
								: history.pushState(JSON.parse(JSON.stringify(options)), options.title, ajax_send_url || options.url);
						}
						catch (e) {
							try{
								options.replace
									? history.replaceState(options.data, options.title, ajax_send_url || options.url)
									: history.pushState(options.data, options.title, ajax_send_url || options.url);

							}
							catch (e){
								console.error(e);
							}
						}
					}
					$(document).trigger('statio:global:success', [options.context, response.data, response.body, jqXHR]);
					options.context.trigger('statio:success', [response.data, response.body, jqXHR]);
					if(options.type != 'url')
					{
						render();
					}
				}
				else
				{
					$(document).trigger('statio:global:errorResponse', [options.context, response.data, response.body, jqXHR]);
					options.context.trigger('statio:errorResponse', [response.data, response.body, jqXHR]);
				}
			}
			$(document).trigger('statio:global:done', [options.context, response.data, response.body, jqXHR]);
			options.context.trigger('statio:done', [response.data, response.body, jqXHR]);
		}

		function response_parse(){
			if(typeof response.body == 'string')
			{
				try
				{
					var split     = response.body.split("\n");
					response.data = JSON.parse(split[0]);
					response.body = split.length > 1 ? $($.parseHTML(split.splice(1).join(""))) : null;
				}catch(e){
					response.body  = $($.parseHTML(response.body));
				}
			}
			else if(typeof response.body == 'object' && response.body != null)
			{
				if(response.body instanceof HTMLElement)
				{
					response.body  = $(response.body);
				}
				else if(response.body instanceof jQuery)
				{

				}
				else
				{
					response.data = response.body;
					response.body = null;
				}
			}
		}

		function render(){
			for(D in response.data)
			{
				if(options.globals[D])
				{
					options.globals[D](response.data[D]);
				}
			}
			if(response.body)
			{
				var changed = [];
				response.body.each(function(){
					var base = $(this).attr('data-xhr');
					if(base)
					{
						changed.push($("[data-xhr='"+base+"']"));
						$("[data-xhr='"+base+"']").html($(this).html());
					}
				});
				$(document).trigger('statio:global:renderResponse', [$(changed), options.context, response.data, response.body]);
				options.context.trigger('statio:renderResponse', [$(changed), response.data, response.body]);
			}
		}
		return this;
	}
	window.Statio = statio;
	/**
	 * for new chrome bug
	 */
	 new Statio({
	 	url : location.href,
	 	fake : true,
	 	replace : true
	 });

	/**
	 * popstate event
	 */
	 window.onpopstate = function(event){
	 	new Statio({
	 		url : location.href,
	 		replace : true
	 	});
	 };
})();

// Copyright 2013-2014 Kevin Cox

/*******************************************************************************
*                                                                              *
*  This software is provided 'as-is', without any express or implied           *
*  warranty. In no event will the authors be held liable for any damages       *
*  arising from the use of this software.                                      *
*                                                                              *
*  Permission is granted to anyone to use this software for any purpose,       *
*  including commercial applications, and to alter it and redistribute it      *
*  freely, subject to the following restrictions:                              *
*                                                                              *
*  1. The origin of this software must not be misrepresented; you must not     *
*     claim that you wrote the original software. If you use this software in  *
*     a product, an acknowledgment in the product documentation would be       *
*     appreciated but is not required.                                         *
*                                                                              *
*  2. Altered source versions must be plainly marked as such, and must not be  *
*     misrepresented as being the original software.                           *
*                                                                              *
*  3. This notice may not be removed or altered from any source distribution.  *
*                                                                              *
*******************************************************************************/

+function(){
"use strict";

var array = /\[([^\[]*)\]$/;

/// URL Regex.
/**
 * This regex splits the URL into parts.  The capture groups catch the important
 * bits.
 *
 * Each section is optional, so to work on any part find the correct top level
 * `(...)?` and mess around with it.
 */
var regex = /^(?:([a-z]*):)?(?:\/\/)?(?:([^:@]*)(?::([^@]*))?@)?([0-9a-z-._]+)?(?::([0-9]*))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.*))?$/i;
//               1 - scheme              2 - user    3 = pass    4 - host           5 - port  6 - path        7 - query    8 - hash

var noslash = ["mailto","bitcoin"];

var self = {
	/** Parse a query string.
	 *
	 * This function parses a query string (sometimes called the search
	 * string).  It takes a query string and returns a map of the results.
	 *
	 * Keys are considered to be everything up to the first '=' and values are
	 * everything afterwords.  Since URL-decoding is done after parsing, keys
	 * and values can have any values, however, '=' have to be encoded in keys
	 * while '?' and '&' have to be encoded anywhere (as they delimit the
	 * kv-pairs).
	 *
	 * Keys and values will always be strings, except if there is a key with no
	 * '=' in which case it will be considered a flag and will be set to true.
	 * Later values will override earlier values.
	 *
	 * Array keys are also supported.  By default keys in the form of `name[i]`
	 * will be returned like that as strings.  However, if you set the `array`
	 * flag in the options object they will be parsed into arrays.  Note that
	 * although the object returned is an `Array` object all keys will be
	 * written to it.  This means that if you have a key such as `k[forEach]`
	 * it will overwrite the `forEach` function on that array.  Also note that
	 * string properties always take precedence over array properties,
	 * irrespective of where they are in the query string.
	 *
	 *   url.get("array[1]=test&array[foo]=bar",{array:true}).array[1]  === "test"
	 *   url.get("array[1]=test&array[foo]=bar",{array:true}).array.foo === "bar"
	 *   url.get("array=notanarray&array[0]=1",{array:true}).array      === "notanarray"
	 *
	 * If array parsing is enabled keys in the form of `name[]` will
	 * automatically be given the next available index.  Note that this can be
	 * overwritten with later values in the query string.  For this reason is
	 * is best not to mix the two formats, although it is safe (and often
	 * useful) to add an automatic index argument to the end of a query string.
	 *
	 *   url.get("a[]=0&a[]=1&a[0]=2", {array:true})  -> {a:["2","1"]};
	 *   url.get("a[0]=0&a[1]=1&a[]=2", {array:true}) -> {a:["0","1","2"]};
	 *
	 * @param{string} q The query string (the part after the '?').
	 * @param{{full:boolean,array:boolean}=} opt Options.
	 *
	 * - full: If set `q` will be treated as a full url and `q` will be built.
	 *   by calling #parse to retrieve the query portion.
	 * - array: If set keys in the form of `key[i]` will be treated
	 *   as arrays/maps.
	 *
	 * @return{!Object.<string, string|Array>} The parsed result.
	 */
	"get": function(q, opt){
		q = q || "";
		if ( typeof opt          == "undefined" ) opt = {};
		if ( typeof opt["full"]  == "undefined" ) opt["full"] = false;
		if ( typeof opt["array"] == "undefined" ) opt["array"] = false;

		if ( opt["full"] === true )
		{
			q = self["parse"](q, {"get":false})["query"] || "";
		}

		var o = {};

		var c = q.split("&");
		for (var i = 0; i < c.length; i++)
		{
			if (!c[i].length) continue;

			var d = c[i].indexOf("=");
			var k = c[i], v = true;
			if ( d >= 0 )
			{
				k = c[i].substr(0, d);
				v = c[i].substr(d+1);

				v = decodeURIComponent(v);
			}

			if (opt["array"])
			{
				var inds = [];
				var ind;
				var curo = o;
				var curk = k;
				while (ind = curk.match(array)) // Array!
				{
					curk = curk.substr(0, ind.index);
					inds.unshift(decodeURIComponent(ind[1]));
				}
				curk = decodeURIComponent(curk);
				if (inds.some(function(i)
				{
					if ( typeof curo[curk] == "undefined" ) curo[curk] = [];
					if (!Array.isArray(curo[curk]))
					{
						//console.log("url.get: Array property "+curk+" already exists as string!");
						return true;
					}

					curo = curo[curk];

					if ( i === "" ) i = curo.length;

					curk = i;
				})) continue;
				curo[curk] = v;
				continue;
			}

			k = decodeURIComponent(k);

			//typeof o[k] == "undefined" || console.log("Property "+k+" already exists!");
			o[k] = v;
		}

		return o;
	},

	/** Build a get query from an object.
	 *
	 * This constructs a query string from the kv pairs in `data`.  Calling
	 * #get on the string returned should return an object identical to the one
	 * passed in except all non-boolean scalar types become strings and all
	 * object types become arrays (non-integer keys are still present, see
	 * #get's documentation for more details).
	 *
	 * This always uses array syntax for describing arrays.  If you want to
	 * serialize them differently (like having the value be a JSON array and
	 * have a plain key) you will need to do that before passing it in.
	 *
	 * All keys and values are supported (binary data anyone?) as they are
	 * properly URL-encoded and #get properly decodes.
	 *
	 * @param{Object} data The kv pairs.
	 * @param{string} prefix The properly encoded array key to put the
	 *   properties.  Mainly intended for internal use.
	 * @return{string} A URL-safe string.
	 */
	"buildget": function(data, prefix){
		var itms = [];
		for ( var k in data )
		{
			var ek = encodeURIComponent(k);
			if ( typeof prefix != "undefined" )
				ek = prefix+"["+ek+"]";

			var v = data[k];

			switch (typeof v)
			{
				case 'boolean':
					if(v) itms.push(ek);
					break;
				case 'number':
					v = v.toString();
				case 'string':
					itms.push(ek+"="+encodeURIComponent(v));
					break;
				case 'object':
					itms.push(self["buildget"](v, ek));
					break;
			}
		}
		return itms.join("&");
	},

	/** Parse a URL
	 *
	 * This breaks up a URL into components.  It attempts to be very liberal
	 * and returns the best result in most cases.  This means that you can
	 * often pass in part of a URL and get correct categories back.  Notably,
	 * this works for emails and Jabber IDs, as well as adding a '?' to the
	 * beginning of a string will parse the whole thing as a query string.  If
	 * an item is not found the property will be undefined.  In some cases an
	 * empty string will be returned if the surrounding syntax but the actual
	 * value is empty (example: "://example.com" will give a empty string for
	 * scheme.)  Notably the host name will always be set to something.
	 *
	 * Returned properties.
	 *
	 * - **scheme:** The url scheme. (ex: "mailto" or "https")
	 * - **user:** The username.
	 * - **pass:** The password.
	 * - **host:** The hostname. (ex: "localhost", "123.456.7.8" or "example.com")
	 * - **port:** The port, as a number. (ex: 1337)
	 * - **path:** The path. (ex: "/" or "/about.html")
	 * - **query:** "The query string. (ex: "foo=bar&v=17&format=json")
	 * - **get:** The query string parsed with get.  If `opt.get` is `false` this
	 *   will be absent
	 * - **hash:** The value after the hash. (ex: "myanchor")
	 *   be undefined even if `query` is set.
	 *
	 * @param{string} url The URL to parse.
	 * @param{{get:Object}=} opt Options:
	 *
	 * - get: An options argument to be passed to #get or false to not call #get.
	 *    **DO NOT** set `full`.
	 *
	 * @return{!Object} An object with the parsed values.
	 */
	"parse": function(url, opt) {

		if ( typeof opt == "undefined" ) opt = {};

		var md = url.match(regex) || [];

		var r = {
			"url":    url,

			"scheme": md[1],
			"user":   md[2],
			"pass":   md[3],
			"host":   md[4],
			"port":   md[5] && +md[5],
			"path":   md[6],
			"query":  md[7],
			"hash":   md[8],
		};

		if ( opt.get !== false )
			r["get"] = r["query"] && self["get"](r["query"], opt.get);

		return r;
	},

	/** Build a URL from components.
	 *
	 * This pieces together a url from the properties of the passed in object.
	 * In general passing the result of `parse()` should return the URL.  There
	 * may differences in the get string as the keys and values might be more
	 * encoded then they were originally were.  However, calling `get()` on the
	 * two values should yield the same result.
	 *
	 * Here is how the parameters are used.
	 *
	 *  - url: Used only if no other values are provided.  If that is the case
	 *     `url` will be returned verbatim.
	 *  - scheme: Used if defined.
	 *  - user: Used if defined.
	 *  - pass: Used if defined.
	 *  - host: Used if defined.
	 *  - path: Used if defined.
	 *  - query: Used only if `get` is not provided and non-empty.
	 *  - get: Used if non-empty.  Passed to #buildget and the result is used
	 *    as the query string.
	 *  - hash: Used if defined.
	 *
	 * These are the options that are valid on the options object.
	 *
	 *  - useemptyget: If truthy, a question mark will be appended for empty get
	 *    strings.  This notably makes `build()` and `parse()` fully symmetric.
	 *
	 * @param{Object} data The pieces of the URL.
	 * @param{Object} opt Options for building the url.
	 * @return{string} The URL.
	 */
	"build": function(data, opt){
		opt = opt || {};

		var r = "";

		if ( typeof data["scheme"] != "undefined" )
		{
			r += data["scheme"];
			r += (noslash.indexOf(data["scheme"])>=0)?":":"://";
		}
		if ( typeof data["user"] != "undefined" )
		{
			r += data["user"];
			if ( typeof data["pass"] == "undefined" )
			{
				r += "@";
			}
		}
		if ( typeof data["pass"] != "undefined" ) r += ":" + data["pass"] + "@";
		if ( typeof data["host"] != "undefined" ) r += data["host"];
		if ( typeof data["port"] != "undefined" ) r += ":" + data["port"];
		if ( typeof data["path"] != "undefined" ) r += data["path"];

		if (opt["useemptyget"])
		{
			if      ( typeof data["get"]   != "undefined" ) r += "?" + self["buildget"](data["get"]);
			else if ( typeof data["query"] != "undefined" ) r += "?" + data["query"];
		}
		else
		{
			// If .get use it.  If .get leads to empty, use .query.
			var q = data["get"] && self["buildget"](data["get"]) || data["query"];
			if (q) r += "?" + q;
		}

		if ( typeof data["hash"] != "undefined" ) r += "#" + data["hash"];

		return r || data["url"] || "";
	},
};

if ( typeof define != "undefined" && define["amd"] ) define(self);
else if ( typeof module != "undefined" ) module['exports'] = self;
else window["url"] = self;

}();
const aside = document.querySelector('#aside');
const asideBtn = document.querySelector('#aside-btn');
function handleAside(event) {
    aside.classList.add('open');
}
if (asideBtn)
{
    asideBtn.addEventListener('click', handleAside);
}

const profile = document.querySelector('.profile');

if (profile)
{
    const dropdown = document.querySelector('.profile-dropdown');

    function handleProfileClick(event) {
        dropdown.classList.add('open');
    }
    profile.addEventListener('click', handleProfileClick);
    window.addEventListener('click', function(event) {
        if (!event.target.closest('.profile-div')) {
            dropdown.classList.remove('open');
        }
        if (!event.target.closest('#aside') && !event.target.closest('#aside-btn')) {
            aside.classList.remove('open');
        }
    });
}


am4core.ready(function () {

    // Themes begin
    am4core.useTheme(am4themes_amcharts);
    // Themes end

    // Create chart instance
    var chart = am4core.create("chartdiv", am4charts.XYChart);

    chart.rtl = true;

    // Add data
    chart.data = [{
        "country": "USA",
        "visits": 2025
    }, {
        "country": "China",
        "visits": 1882
    }, {
        "country": "Japan",
        "visits": 1809
    }, {
        "country": "Germany",
        "visits": 1322
    }, {
        "country": "UK",
        "visits": 1122
    }, {
        "country": "France",
        "visits": 1114
    }, {
        "country": "India",
        "visits": 984
    }, {
        "country": "Spain",
        "visits": 711
    }, {
        "country": "Netherlands",
        "visits": 665
    }, {
        "country": "Russia",
        "visits": 580
    }, {
        "country": "South Korea",
        "visits": 443
    }, {
        "country": "Canada",
        "visits": 441
    }, {
        "country": "Brazil",
        "visits": 395
    }];

    // Create axes

    var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
    categoryAxis.dataFields.category = "country";
    categoryAxis.renderer.grid.template.location = 0;
    categoryAxis.renderer.minGridDistance = 30;

    categoryAxis.renderer.labels.template.adapter.add("dy", function (dy, target) {
        if (target.dataItem && target.dataItem.index & 2 == 2) {
            return dy + 25;
        }
        return dy;
    });

    var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

    // Create series
    var series = chart.series.push(new am4charts.ColumnSeries());
    series.dataFields.valueY = "visits";
    series.dataFields.categoryX = "country";
    series.name = "Visits";
    series.columns.template.tooltipText = "{categoryX}: [bold]{valueY}[/]";
    series.columns.template.fillOpacity = .8;

    var columnTemplate = series.columns.template;
    columnTemplate.strokeWidth = 2;
    columnTemplate.strokeOpacity = 1;

}); // end am4core.ready()

$(document).ready(function() {
    $('.select2').select2();
});

function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function(e) {
            $(input).next('label').children('img').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
  }

$('.input-avatar').change(function() {
    readURL(this);
});

var datepicker = function (elementID, opt) {

    // check arguments
    if (typeof elementID !== "string" || elementID.length === 0) {
        console.error("datepicker error: input ID is not string or is empty");
        return;
    }
    var options = opt || {};

    // variables
    var isCalClicked = false;
    var isSynced = false;

    var dayOfWeek;

    var selectedYear;
    var selectedMonth;
    var selectedDay;

    var currentYear;
    var currentMonth;
    var currentDay;

    var todaysYear;
    var todaysMonth;
    var todaysDay;

    var dayOfWeekJ;

    var numberOfDays;

    var todayG;
    var todaysJ;

    // consts
    var MONTH_NAMES = {
        "1": "فروردین"
        , "2": "اردیبهشت"
        , "3": "خرداد"
        , "4": "تیر"
        , "5": "مرداد"
        , "6": "شهریور"
        , "7": "مهر"
        , "8": "آبان"
        , "9": "آذر"
        , "10": "دی"
        , "11": "بهمن"
        , "12": "اسفند"
    }
    var DAY_NAMES = {
        "شنبه": "ش"
        , "یکشنبه": "ی"
        , "دوشنبه": "د"
        , "سه شنبه": "س"
        , "چهارشنبه": "چ"
        , "پنج شنبه": "پ"
        , "جمعه": "ج"
    };
    var FA_NUMS = ['٠', '١', '٢', '٣', '۴', '۵', '۶', '٧', '٨', '٩', '١٠', '١١', '١٢', '١٣', '١۴', '١۵', '١۶', '١٧', '١٨', '١٩', '٢٠', '٢١', '٢٢', '٢٣', '٢۴', '٢۵', '٢۶', '٢٧', '٢٨', '٢٩', '٣٠', '٣١', '٣٢'];

    // set options
    options.placeholder = options.placeholder !== undefined ? options.placeholder : "";
    options.twodigit = options.twodigit !== undefined ? options.twodigit : true;
    options.closeAfterSelect = options.closeAfterSelect !== undefined ? options.closeAfterSelect : true;
    options.nextButtonIcon = options.nextButtonIcon !== undefined ? options.nextButtonIcon : false;
    options.previousButtonIcon = options.previousButtonIcon !== undefined ? options.previousButtonIcon : false;
    options.buttonsColor = options.buttonsColor !== undefined ? options.buttonsColor : false;
    options.forceFarsiDigits = options.forceFarsiDigits !== undefined ? options.forceFarsiDigits : false;
    options.markToday = options.markToday !== undefined ? options.markToday : false;
    options.markHolidays = options.markHolidays !== undefined ? options.markHolidays : false;
    options.highlightSelectedDay = options.highlightSelectedDay !== undefined ? options.highlightSelectedDay : false;
    options.sync = options.sync !== undefined ? options.sync : false;
    options.gotoToday = options.gotoToday !== undefined ? options.gotoToday : false;

    // create DOM
    var inputElement = $("#" + elementID);

    if (inputElement.attr("placeholder") === undefined) {
        inputElement.attr("placeholder", options.placeholder);
    }

    // create parent div
    inputElement.wrap("<div id='bd-root-" + elementID + "' style='position: relative;'></div>");

    // create main div for calendar, below input element
    inputElement.after("<div id='bd-main-" + elementID + "' class='bd-main bd-hide' style='position: absolute; direction: rtl;'></div>");
    var mainDiv = $("#bd-main-" + elementID);

    // create calendar div inside main div
    mainDiv.append("<div class='bd-calendar'></div>");
    var calendarDiv = mainDiv.find('.bd-calendar');

    // create title div and table inside calendar div
    calendarDiv.append("<div class='bd-title'></div>");
    var titleDiv = calendarDiv.find('.bd-title');
    calendarDiv.append("<table class='bd-table' dir='rtl' cellspacing='0' cellpadding='0'></table>");

    // create month and year drop downs and next/prev month buttons inside title div
    titleDiv.append("<button id='bd-next-" + elementID + "' class='bd-next' type='button' title='ماه بعدی' data-toggle='tooltip'><span>بعدی</span></button>");
    var nextMonth = $("#bd-next-" + elementID);
    if (options.nextButtonIcon) {
        nextMonth.find("span").css("display", "none");
        if (options.nextButtonIcon.indexOf(".") !== -1) {
            // image
            nextMonth.css("background-image", "url(" + options.nextButtonIcon + ")");
        } else {
            // css class
            nextMonth.addClass(options.nextButtonIcon);
        }
    }

    titleDiv.append("<div class='bd-dropdown'></div><div class='bd-dropdown'></div>");

    titleDiv.find('.bd-dropdown:nth-child(2)').append("<select id='bd-month-" + elementID + "' class='bd-month'></select>");
    var monthDropdown = $("#bd-month-" + elementID);
    $.each(MONTH_NAMES, function (key, value) {
        monthDropdown.append($("<option></option>").attr("value", key).text(value));
    });

    titleDiv.find('.bd-dropdown:nth-child(3)').append("<select id='bd-year-" + elementID + "' class='bd-year'></select>");
    var yearDropdown = $("#bd-year-" + elementID);

    titleDiv.append("<button id='bd-prev-" + elementID + "' class='bd-prev' type='button' title='ماه قبلی' data-toggle='tooltip'><span>قبلی</span></button>");
    var prevMonth = $("#bd-prev-" + elementID);
    if (options.nextButtonIcon) {
        prevMonth.find("span").css("display", "none");
        if (options.previousButtonIcon.indexOf(".") !== -1) {
            // image
            prevMonth.css("background-image", "url(" + options.previousButtonIcon + ")");
        } else {
            // css class
            prevMonth.addClass(options.previousButtonIcon);
        }
    }

    if (options.buttonsColor) {
        nextMonth.css("color", options.buttonsColor);
        nextMonth.find("span").css("color", options.buttonsColor);
        prevMonth.css("color", options.buttonsColor);
        prevMonth.find("span").css("color", options.buttonsColor);
    }

    // create table header and body
    calendarDiv.find('.bd-table').append("<thead><tr></tr></thead>");
    $.each(DAY_NAMES, function (key, value) {
        calendarDiv.find('.bd-table thead tr').append($("<th></th>").text(value));
    });

    calendarDiv.find('.bd-table').append("<tbody id='bd-table-days-" + elementID + "' class='bd-table-days'></tbody>");
    var daysTable = $("#bd-table-days-" + elementID);

    // create go to todays button
    if (options.gotoToday) {
        calendarDiv.append("<div class='bd-goto-today'>برو به امروز</div>");
        var gotoToday = calendarDiv.find(".bd-goto-today");
    }

    // opening and closing functionality
    inputElement.on("focus", function () {
        mainDiv.removeClass("bd-hide");
        if (options.sync && isSynced === false) {
            syncCalendar();
            isSynced = true;
        }
        mainDiv;
    }).on('blur', function () {
        if (isCalClicked == false) {
            mainDiv.addClass("bd-hide");
            isSynced = false;
        } else {
            isCalClicked = false;
            inputElement.focus();
            event.preventDefault();
        }
    });

    mainDiv.on('mousedown', function (event) {
        isCalClicked = true;
    });

    // dropdown events
    monthDropdown.on('change', function () {
        selectedMonth = parseInt(this.value);
        numberOfDays = monthDays(selectedYear, selectedMonth);
        dayOfWeekJ = findFirstDayOfMonth(selectedYear, selectedMonth);
        drawDays(numberOfDays, dayOfWeekJ);
    });
    yearDropdown.on('change', function () {
        selectedYear = parseInt(this.value);
        numberOfDays = monthDays(selectedYear, selectedMonth);
        dayOfWeekJ = findFirstDayOfMonth(selectedYear, selectedMonth);
        drawDays(numberOfDays, dayOfWeekJ);
    });

    // Georgian to Jalali converter (minified)
    // source is unknown. contact if you know the code owner.
    function gregorianToJalali(a, r, s) { a = parseInt(a), r = parseInt(r), s = parseInt(s); for (var n = a - 1600, e = r - 1, t = s - 1, p = 365 * n + parseInt((n + 3) / 4) - parseInt((n + 99) / 100) + parseInt((n + 399) / 400), I = 0; e > I; ++I) p += g_days[I]; e > 1 && (n % 4 == 0 && n % 100 != 0 || n % 400 == 0) && ++p, p += t; var v = p - 79, d = parseInt(v / 12053); v %= 12053; var o = 979 + 33 * d + 4 * parseInt(v / 1461); v %= 1461, v >= 366 && (o += parseInt((v - 1) / 365), v = (v - 1) % 365); for (var I = 0; 11 > I && v >= j_days[I]; ++I) v -= j_days[I]; var y = I + 1, _ = v + 1; return [o, y, _] } var g_days = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31], j_days = [31, 31, 31, 31, 31, 31, 30, 30, 30, 30, 30, 29];
    // Jalali to Georgian converter (minified)
    // source is unknown. contact if you know the code owner.
    function toJalaali(d, i, a) { return d2j(g2d(d, i, a)) } function toGregorian(d, i, a) { return d2g(j2d(d, i, a)) } function isValidJalaaliDate(d, i, a) { return d >= -61 && 3177 >= d && i >= 1 && 12 >= i && a >= 1 && a <= jalaaliMonthLength(d, i) } function isLeapJalaaliYear(d) { return 0 === jalCal(d).leap } function jalaaliMonthLength(d, i) { return 6 >= i ? 31 : 11 >= i ? 30 : isLeapJalaaliYear(d) ? 30 : 29 } function jalCal(d) { var i, a, n, r, t, o, v, e = [-61, 9, 38, 199, 426, 686, 756, 818, 1111, 1181, 1210, 1635, 2060, 2097, 2192, 2262, 2324, 2394, 2456, 3178], l = e.length, u = d + 621, m = -14, g = e[0]; if (g > d || d >= e[l - 1]) throw new Error("Invalid Jalaali year " + d); for (v = 1; l > v && (i = e[v], a = i - g, !(i > d)); v += 1) m = m + 8 * div(a, 33) + div(mod(a, 33), 4), g = i; return o = d - g, m = m + 8 * div(o, 33) + div(mod(o, 33) + 3, 4), 4 === mod(a, 33) && a - o === 4 && (m += 1), r = div(u, 4) - div(3 * (div(u, 100) + 1), 4) - 150, t = 20 + m - r, 6 > a - o && (o = o - a + 33 * div(a + 4, 33)), n = mod(mod(o + 1, 33) - 1, 4), -1 === n && (n = 4), { leap: n, gy: u, march: t } } function j2d(d, i, a) { var n = jalCal(d); return g2d(n.gy, 3, n.march) + 31 * (i - 1) - div(i, 7) * (i - 7) + a - 1 } function d2j(d) { var i, a, n, r = d2g(d).gy, t = r - 621, o = jalCal(t), v = g2d(r, 3, o.march); if (n = d - v, n >= 0) { if (185 >= n) return a = 1 + div(n, 31), i = mod(n, 31) + 1, { jy: t, jm: a, jd: i }; n -= 186 } else t -= 1, n += 179, 1 === o.leap && (n += 1); return a = 7 + div(n, 30), i = mod(n, 30) + 1, { jy: t, jm: a, jd: i } } function g2d(d, i, a) { var n = div(1461 * (d + div(i - 8, 6) + 100100), 4) + div(153 * mod(i + 9, 12) + 2, 5) + a - 34840408; return n = n - div(3 * div(d + 100100 + div(i - 8, 6), 100), 4) + 752 } function d2g(d) { var i, a, n, r, t; return i = 4 * d + 139361631, i = i + 4 * div(3 * div(4 * d + 183187720, 146097), 4) - 3908, a = 5 * div(mod(i, 1461), 4) + 308, n = div(mod(a, 153), 5) + 1, r = mod(div(a, 153), 12) + 1, t = div(i, 1461) - 100100 + div(8 - r, 6), { gy: t, gm: r, gd: n } } function div(d, i) { return ~~(d / i) } function mod(d, i) { return d - ~~(d / i) * i }

    var syncCalendar = function () {
        var inputValue = fixDate(inputElement.val());
        if (inputValue === "")
            return;

        inputValue = inputValue.split("/");
        monthDropdown.val(parseInt(inputValue[1]));
        monthDropdown.trigger("change");
        yearDropdown.val(parseInt(inputValue[0]));
        yearDropdown.trigger("change");

        if (options.highlightSelectedDay) {
            mainDiv.find(".bd-selected-day").removeClass("bd-selected-day");
            mainDiv.find(".day-" + parseInt(inputValue[2])).addClass("bd-selected-day");
        }
    }

    var fixDate = function (date) {
        if (date === "")
            return "";

        date = date.split("/");
        // if (date[0].length === 2) {
        //     date[0] = "13" + date[0];
        // }
        if (date[1].length < 2) {
            if (date[1] < 10) {
                date[1] = "0" + date[1];
            }
        }
        if (date[2].length < 2) {
            if (date[2] < 10) {
                date[2] = "0" + date[2];
            }
        }
        date = date.join("/");
        return date;
    }

    var convertToJWeek = function (dayOfWeekG) {
        var dayOfWeekJ;
        if (dayOfWeekG < 6) {
            dayOfWeekJ = dayOfWeekG + 1;
        } else {
            dayOfWeekJ = 0;
        }
        return dayOfWeekJ;
    }

    var makeYearList = function (thisYear) {
        yearDropdown.find('option').remove();
        for (i = 0; i < 101; i++) {
            var tempYear = ((thisYear - 95) + i) + '';
            if (options.forceFarsiDigits) {
                for (var j = 0; j < 10; j++) {
                    var rgx = new RegExp(j, 'g');
                    tempYear = tempYear.replace(rgx, FA_NUMS[j]);
                }
            }
            yearDropdown.append($('<option>', {
                value: (thisYear - 95) + i,
                text: tempYear
            }));
        }
    }

    // isleap calculator, supported year: 1243 - 1473
    var isLeapYear = function (year) {
        var mod;
        if (year < 1343 && year > 1243) {
            mod = year % 33;
            if (mod == 1 || mod == 5 || mod == 9 || mod == 13 || mod == 17 || mod == 22 || mod == 26 || mod == 30) {
                return true;
            } else {
                return false;
            }
        } else if (year < 1473 && year > 1342) {
            mod = year % 17;
            if (mod == 1 || mod == 5 || mod == 9 || mod == 13 || mod == 18 || mod == 22 || mod == 26 || mod == 30) {
                return true;
            } else {
                return false
            }
        } else {
            return "unknown";
        }
    }

    var monthDays = function (year, month) {
        if (month < 7) {
            return 31;
        } else if (month < 12) {
            return 30;
        } else {
            if (isLeapYear(year)) {
                return 30;
            } else {
                return 29;
            }
        }
    }

    // make first page of calendar
    todayG = new Date();

    todaysJ = gregorianToJalali(todayG.getFullYear(), todayG.getMonth() + 1, todayG.getDate());
    var selectedDateJ = [];
    for (i = 0; i < 3; i++) {
        selectedDateJ[i] = todaysJ[i];
    }

    todaysYear = todaysJ[0];
    todaysMonth = todaysJ[1];
    todaysDay = todaysJ[2];

    selectedYear = selectedDateJ[0];
    selectedMonth = selectedDateJ[1];
    selectedDay = selectedDateJ[2];

    monthDropdown.val(selectedMonth);
    makeYearList(selectedYear);
    yearDropdown.val(selectedYear);

    numberOfDays = monthDays(selectedYear, selectedMonth);

    // find first day of month in week
    var findFirstDayOfMonth = function (selectedYear, selectedMonth) {
        var firstDayOfMonthG = toGregorian(selectedYear, selectedMonth, 1);
        firstDayOfMonthG = new Date(firstDayOfMonthG.gy + "/" + firstDayOfMonthG.gm + "/" + firstDayOfMonthG.gd);
        return convertToJWeek(firstDayOfMonthG.getDay());
    }
    dayOfWeekJ = findFirstDayOfMonth(selectedYear, selectedMonth);

    // draw days on calendar
    var drawDays = function (numberOfDays, dayOfWeekJ) {
        daysTable.empty();
        var dayIndex = 1;
        var rowIndex = 1;
        while (dayIndex <= numberOfDays) {
            daysTable.append($('<tr>', {
                class: "tr-" + rowIndex
            }));
            for (i = 0; i < 7; i++) {
                if (dayIndex == 1) {
                    var j = 0;
                    while (j < dayOfWeekJ) {
                        $("#bd-table-days-" + elementID + " .tr-1").append($('<td>', {
                            class: "bd-empty-cell"
                        })
                        );
                        j++;
                        i++;
                    }
                }
                if (i < 7 && dayIndex <= numberOfDays) {
                    var tempTD = '<td>' +
                        '<button class="day day-' + dayIndex + '" type="button">' + (options.forceFarsiDigits ? FA_NUMS[dayIndex] : dayIndex) + '</button>' +
                        '</td>';

                    // mark todays day by adding .bd-today class
                    if (options.markToday) {
                        if (dayIndex == todaysDay && todaysMonth == selectedMonth && todaysYear == selectedYear) {
                            var idx = tempTD.indexOf('day day-');
                            tempTD = tempTD.slice(0, idx) + ' bd-today ' + tempTD.slice(idx);
                        }
                    }

                    // mark holidays by adding .bd-holiday class
                    if (options.markHolidays) {
                        if (i == 6) {
                            var idx = tempTD.indexOf('day day-');
                            tempTD = tempTD.slice(0, idx) + ' bd-holiday ' + tempTD.slice(idx);
                        }
                    }

                    $("#bd-table-days-" + elementID + " .tr-" + rowIndex).append(tempTD);

                    dayIndex++;
                }
            }
            rowIndex++;
        }

        if (options.highlightSelectedDay) {
            var inputValue = inputElement.val();
            inputValue = inputValue.split("/");
            if (inputValue[0] == selectedYear && inputValue[1] == selectedMonth) {
                mainDiv.find(".bd-selected-day").removeClass("bd-selected-day");
                mainDiv.find(".day-" + parseInt(inputValue[2])).addClass("bd-selected-day");
            }
        }

    }

    inputElement.parent().on("click", "button.day", function () {
        var datestr = selectedYear + "/" + selectedMonth + "/" + $(this).attr('class').split(" ")[$(this).attr('class').split(" ").indexOf('day') + 1].split("-")[1];
        if (options.twodigit) {
            datestr = fixDate(datestr);
        }
        inputElement.val(datestr);
        inputElement.trigger("change");
        if (options.closeAfterSelect) {
            isCalClicked = false;
            inputElement.trigger("blur");
        }

        if (options.highlightSelectedDay) {
            mainDiv.find(".bd-selected-day").removeClass("bd-selected-day");
            $(this).addClass("bd-selected-day");
        }
    });

    nextMonth.on("click", function () {
        //console.log("month: " + selectedMonth + ", year: " + selectedYear);
        if (monthDropdown.val() < 12) {
            monthDropdown.val(parseInt(monthDropdown.val()) + 1);
            monthDropdown.trigger("change");
        } else {
            monthDropdown.val(1);
            monthDropdown.trigger("change");
            yearDropdown.val(parseInt(yearDropdown.val()) + 1);
            yearDropdown.trigger("change");
        }
    });

    prevMonth.on("click", function () {
        if (monthDropdown.val() > 1) {
            monthDropdown.val(parseInt(monthDropdown.val()) - 1);
            monthDropdown.trigger("change");
        } else {
            monthDropdown.val(12);
            monthDropdown.trigger("change");
            yearDropdown.val(parseInt(yearDropdown.val()) - 1);
            yearDropdown.trigger("change");
        }
    });

    if (options.gotoToday) {
        gotoToday.on("click", function () {
            monthDropdown.val(todaysMonth);
            monthDropdown.trigger("change");
            yearDropdown.val(todaysYear);
            yearDropdown.trigger("change");
        });
    }

    drawDays(numberOfDays, dayOfWeekJ);

    // enable bootstrap tooltip if bootstrap is loaded
    if (typeof $().modal == 'function') {
        $('[data-toggle="tooltip"]').tooltip();
    }

}

var media_xm = window.matchMedia("(max-width: 575.98px)");
var media_sm = window.matchMedia("(min-width: 576px) and (max-width: 767.98px)");
var media_md = window.matchMedia("(min-width: 768px) and (max-width: 991.98px)");
var media_lg = window.matchMedia("(min-width: 992px) and (max-width: 1199.98px)");
var media_xl = window.matchMedia("(min-width: 1200px)");


function event_media_xm(media){
	if(media.matches) return $(document).trigger('media:xm', [media]);
	else return $(document).trigger('media:xm:exit', [media]);
}
function event_media_sm(media){
	if(media.matches) return $(document).trigger('media:sm', [media]);
	else return $(document).trigger('media:sm:exit', [media]);
}
function event_media_md(media){
	if(media.matches) return $(document).trigger('media:md', [media]);
	else return $(document).trigger('media:md:exit', [media]);
}
function event_media_lg(media){
	if(media.matches) return $(document).trigger('media:lg', [media]);
	else return $(document).trigger('media:lg:exit', [media]);
}
function event_media_xl(media){
	if(media.matches) return $(document).trigger('media:xl', [media]);
	else return $(document).trigger('media:xl:exit', [media]);
}

$(document).ready(function(){
	event_media_xm(media_xm);
	media_xm.addListener(event_media_xm);

	event_media_sm(media_sm);
	media_sm.addListener(event_media_sm);

	event_media_md(media_md);
	media_md.addListener(event_media_md);

	event_media_lg(media_lg);
	media_lg.addListener(event_media_lg);

	event_media_xl(media_xl);
	media_xl.addListener(event_media_xl);
})

$(document).ready(function () {
    $.ajaxSetup(
        {
            headers:
            {
                'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
            }
        }
    );
	$(document).trigger('statio:global:renderResponse', [$(document)]);
});
$(document).on('statio:global:renderResponse', function (event, base, context){
    base.each(function(){
        $('[data-Lijax], .lijax', this).each(function () {
            new Lijax(this);
        });
        $("a", this).not('.direct, [data-direct], [target=_blank], .lijax, [data-lijax]').on('click', function () {
            new Statio({
                url: $(this).attr('href'),
                type: $(this).is('.action') ? 'render' : 'both',
                context: $(this),
            });
            return false;
        });

        $('form[action]', this).not('.direct, [data-direct], [target=_blank], .lijax').each(function () {
            new Lijax(this);
        }).on('jresp', function (e, d) {
            $('.is-invalid', this).removeClass('is-invalid');
            $('.invalid-feedback', this).remove();
            if (d.errors) {
                for (var id in d.errors) {
                    $('#' + id + ', [data-alias~=' + id + ']').addClass('is-invalid');
                    $('<div class="invalid-feedback">' + d.errors[id][0] + '</div>').insertAfter($('#' + id + ', [data-alias~=' + id + ']'));
                }
            }
        });
        $(".select2-select", this).each(function () {
            var options = {
                width: '100%',
                amdLanguageBase: 'dist/vendors/select2-4.0.13/dist/js/i18n',
                language: 'fa',
                minimumInputLength: 0,
                allowClear: $(this).is('[data-allowClear]') || $(this).is('.has-clear'),
                dir: "rtl",
                tags: $(this).is('.tag-type'),
                dropdownParent: $('#' + $(this).attr('data-dropdownParent')).length ? $('#' + $(this).attr('data-dropdownParent')) : undefined
            };
            $(this).attr('data-mr-value', $('[name=' + $(this).attr('data-multi-round') + ']').val());
            $('[name=' + $(this).attr('data-multi-round') + ']').remove();
            if (options.allowClear) {
                options.placeholder = {};
                options.placeholder.text = $('option', this).first().text();
                options.placeholder.id = $('option', this).first().attr('value');
            }
            if ($(this).is('[data-url]')) {
                var title = $(this).attr('data-title') || 'title';
                var _self = this;
                options.ajax = {
                    delay: 250,
                    url: $(this).attr('data-url'),
                    dataType: 'json',
                    quietMillis: 250,
                    data: function (params) {
                        return {
                            q: params.term || ''
                        };
                    },
                    processResults: function (data) {
                        data = data.data || data;
                        var id_property = $(_self).attr('data-id') || 'id';
                        var title_property = $(_self).attr('data-title') || 'title';
                        var result = { results: [] };
                        if ($(_self).is('[data-allowClear]')) {
                            result.results.push({
                                id: '',
                                text: '-',
                                all: null
                            });
                        }
                        for (var i = 0; i < data.length; i++) {
                            var sub_title_property = title_property;
                            if (sub_title_property.indexOf(' ') >= 0) {
                                var sub_title_properties = sub_title_property.split(' ');
                                for (var is = 0; is < sub_title_properties.length; is++) {
                                    if (data[i][sub_title_properties[is]]) {
                                        sub_title_property = sub_title_properties[is];
                                        break;
                                    }

                                }
                            }
                            result.results.push({
                                id: data[i][id_property],
                                text: data[i][sub_title_property],
                                all: data[i]
                            });
                        }
                        return result;
                    },
                    cache: false
                };
            }
            $(this).select2(options);
        });
    });
});
function responsive_menu() {
    $('#menu').removeClass('d-none').addClass('d-flex');
    // $('#desktop').removeClass('d-none');
    $('body').addClass('responsive-menu');
    $('#btn-menu').find($(".fas")).removeClass('fa-bars').addClass('fa-arrow-right');
    $(this).off('click.responsive-menu');
    $(this).on('click.close-responsive-menu', function() {
        $(this).off('click.close-responsive-menu');
        $(this).on('click.responsive-menu', responsive_menu);
        $('#menu').addClass('d-none').removeClass('d-flex');
        // $('#desktop').addClass('d-none');
        $('body').removeClass('responsive-menu');
        $('#btn-menu').find($(".fas")).removeClass('fa-arrow-right').addClass('fa-bars');
    });
}

$(document).on('media:xm media:sm', function(event, media) {
    $("body:not(.responsive-menu) #btn-menu").on('click.responsive-menu', responsive_menu);

    var menu = $('#menu');
    var desktop = $('#desktop');
    var btn_menu = $('#btn-menu');
    $(document).mouseup(function(e) {
        if (
            (!menu.is(e.target) && menu.has(e.target).length === 0)
            && (!desktop.is(e.target) && desktop.has(e.target).length === 0)
            && (!btn_menu.is(e.target) && btn_menu.has(e.target).length === 0)
            )
        {
            $("body.responsive-menu #btn-menu").trigger('click.close-responsive-menu');
        }
    });

    // $("body").swipe({
    //     swipe: function(event, direction, distance, duration, fingerCount, fingerData) {
    //         if (direction == 'left') {
    //             $("body:not(.responsive-menu) #btn-menu").trigger('click.responsive-menu');
    //         }

    //         if (direction == 'right') {
    //             $("body.responsive-menu #btn-menu").trigger('click.close-responsive-menu');
    //         }

    //         if (direction == 'up' || direction == 'down') {
    //             if (!menu.is(event.target) && menu.has(event.target).length === 0) {
    //                 $("body.responsive-menu #btn-menu").trigger('click.close-responsive-menu');
    //             }
    //         }
    //     }
    // });
});

$(document).on('media:md media:lg media:xl', function(event, media) {
    $("body.responsive-menu #btn-menu").trigger('click.close-responsive-menu');
    $("#btn-menu").off('click.responsive-menu');
    // $("#btn-menu").off('click.close-responsive-menu');
    // $('#menu').addClass('d-none').removeClass('d-flex');
    // $('#desktop').addClass('d-none');
    // $('body').removeClass('responsive-menu');
    // $('#btn-menu').find($(".fas")).removeClass('fa-arrow-right').addClass('fa-bars');
});
(function () {
	function ViwFile()
	{
		$('.custom-file-input', this).on('change', function(){
			if (!window.File && !window.FileReader && !window.FileList && !window.Blob) {
				console.error('FileReader unsupported!');
				return false;
			}
			var file_index = 0;
			var file;
			$(this).next().html('');
			var files = [];
			while (file = this.files.item(file_index++))
			{
				files.push(file.name);
			}
			$(this).next().html(files.join(' : '));
		});
	}
	$(document).on('statio:global:renderResponse', function (event, base, contex) {
		base.each(function () {
			ViwFile.call(this);
		});
	});
	ViwFile.call(document);
})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkpSZXNwLmpzIiwiTGlqYXguanMiLCJTdGF0aW8uanMiLCJVcmwuanMiLCJhcHAuanMiLCJkYXRlcGlja2VyLmpzIiwibWVkaWEtZXZlbnQuanMiLCJyZWdpc3Rlci5qcyIsInNpZGViYXItcmVzcG9uc2l2ZS5qcyIsInZpd2ZpbGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0VkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4Y0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InNhcmtvb3QubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7XG5cdGZ1bmN0aW9uIGpyZXNwKGNvbnRleHQsIHJlcylcblx0e1xuXHRcdGNvbnRleHQudHJpZ2dlcignanJlc3AnLCBbcmVzXSk7XG5cdFx0aWYgKHJlcy5tZXNzYWdlICYmICFjb250ZXh0LmlzKCcuZC1ub3RpZmljYXRpb24nKSlcblx0XHR7XG5cdFx0XHRpZiAod2luZG93LnRvYXN0cilcblx0XHRcdHtcblx0XHRcdFx0dmFyIHRvYXN0ID0gdG9hc3RyW3Jlcy5pc19vayA/ICdzdWNjZXNzJyA6ICdlcnJvciddKHJlcy5tZXNzYWdlX3RleHQgfHwgcmVzLm1lc3NhZ2UsIHVuZGVmaW5lZCwge1xuXHRcdFx0XHRcdFwiY2xvc2VCdXR0b25cIjogdHJ1ZSxcblx0XHRcdFx0XHRcIm5ld2VzdE9uVG9wXCI6IHRydWUsXG5cdFx0XHRcdFx0XCJwb3NpdGlvbkNsYXNzXCI6IFwidG9hc3QtYm90dG9tLXJpZ2h0XCIsXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSBpZiAod2luZG93Lml6aVRvYXN0KVxuXHRcdFx0e1xuXHRcdFx0XHRpemlUb2FzdFtyZXMuaXNfb2sgPyAnc3VjY2VzcycgOiAnZXJyb3InXSh7IG1lc3NhZ2U6IHJlcy5tZXNzYWdlX3RleHQgfHwgcmVzLm1lc3NhZ2V9KTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYocmVzLnJlZGlyZWN0KVxuXHRcdHtcblx0XHRcdGlmKHJlcy5kaXJlY3QpXG5cdFx0XHR7XG5cdFx0XHRcdGxvY2F0aW9uLmhyZWYgPSByZXMucmVkaXJlY3Q7XG5cdFx0XHR9XG5cdFx0XHRlbHNlXG5cdFx0XHR7XG5cdFx0XHRcdG5ldyBTdGF0aW8oe1xuXHRcdFx0XHRcdHVybCA6IHJlcy5yZWRpcmVjdFxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0d2luZG93LkpSZXNwID0ganJlc3A7XG59KSgpOyIsIihmdW5jdGlvbigpe1xuXHRmdW5jdGlvbiBsaWpheChjb250ZXh0LCBvbkZpcmUpXG5cdHtcbiAgICAgICAgdmFyIGJhY2tfdmFsdWUgPSAkKGNvbnRleHQpLnZhbCgpIHx8ICQoY29udGV4dCkuYXR0cignZGF0YS12YWx1ZScpO1xuICAgICAgICBpZigkKGNvbnRleHQpLmlzKCc6Y2hlY2tib3gnKSlcbiAgICAgICAge1xuICAgICAgICAgICAgYmFja192YWx1ZSA9ICQoY29udGV4dCkuaXMoJzpjaGVja2VkJykgPyAxIDogMDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgVGltZW91dCA9IG51bGw7XG4gICAgICAgIHZhciBmaXJlID0gbnVsbDtcbiAgICAgICAgaWYoJChjb250ZXh0KS5pcygnZm9ybScpICYmICEkKGNvbnRleHQpLmF0dHIoJ2RhdGEtbGlqYXgnKSlcbiAgICAgICAge1xuICAgICAgICAgICAgZmlyZSA9IFsnc3VibWl0J107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICB7XG4gICAgICAgICAgICBmaXJlID0gJChjb250ZXh0KS5hdHRyKCdkYXRhLWxpamF4Jykuc3BsaXQoJyAnKSB8fCBbJ2NoYW5nZSddO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlyZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYoL15cXGQrJC8udGVzdChmaXJlW2ldKSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgVGltZSA9IGZpcmVbaV07XG4gICAgICAgICAgICAgICAgJChjb250ZXh0KS5vbigna2V5dXAnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBpZihUaW1lb3V0KSBjbGVhclRpbWVvdXQoVGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgIFRpbWVvdXQgPSBzZXRUaW1lb3V0KHNlbmQsIFRpbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICQoY29udGV4dCkub24oZmlyZVtpXSwgc2VuZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZW5kKClcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIGhyZWYgPSB1cmwucGFyc2UobG9jYXRpb24uaHJlZik7XG4gICAgICAgICAgICB2YXIgbmFtZSA9ICQoY29udGV4dCkuYXR0cignbmFtZScpIHx8ICQoY29udGV4dCkuYXR0cignZGF0YS1uYW1lJyk7XG4gICAgICAgICAgICBpZihocmVmLmdldCAmJiBocmVmLmdldFtuYW1lXSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgaHJlZi5nZXRbbmFtZV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZ2V0ID0gdXJsLmJ1aWxkZ2V0KGhyZWYuZ2V0KTtcbiAgICAgICAgICAgIGhyZWYgPSBocmVmLnVybC5yZXBsYWNlKC9cXD8oLiopJC8sIGdldCA/ICc/JyArIGdldCA6ICcnKTtcbiAgICAgICAgICAgIHZhciBhY3Rpb24gPSAkKGNvbnRleHQpLmF0dHIoJ2hyZWYnKSB8fCAkKGNvbnRleHQpLmF0dHIoJ2FjdGlvbicpIHx8ICQoY29udGV4dCkuYXR0cignZGF0YS1hY3Rpb24nKSB8fCBocmVmO1xuICAgICAgICAgICAgdmFyIG1ldGhvZCA9ICQoY29udGV4dCkuYXR0cignZGF0YS1tZXRob2QnKSB8fCAkKGNvbnRleHQpLmF0dHIoJ21ldGhvZCcpIHx8ICdHRVQnO1xuICAgICAgICAgICAgdmFyIHN0YXRlID0gJChjb250ZXh0KS5hdHRyKCdkYXRhLXN0YXRlJyk7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBpZigkKGNvbnRleHQpLmlzKCdmb3JtJykpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIERhdGEgPSBuZXcgRm9ybURhdGEoY29udGV4dCk7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcblx0XHRcdFx0aWYgKCQoY29udGV4dCkuYXR0cignZW5jdHlwZScpID09ICdtdWx0aXBhcnQvZm9ybS1kYXRhJyB8fCAkKCdpbnB1dDpmaWxlJywgY29udGV4dCkubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IERhdGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIERhdGEuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUsIG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbbmFtZV0gPSAvXFxbLipcXF0kLy50ZXN0KG5hbWUpID8gRGF0YS5nZXRBbGwobmFtZSkgOiBEYXRhLmdldChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0YXRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgJChjb250ZXh0KS5hZGRDbGFzcygnbGlqYXgtc2VuZGluZycpO1xuICAgICAgICAgICAgICAgICQoJ2lucHV0LCBzZWxlY3QsIHRleHRhcmVhLCBidXR0b24nLCBjb250ZXh0KS5ub3QoJzpkaXNhYmxlZCcpLmFkZENsYXNzKCdsaWpheC1kaXNhYmxlJykuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAkKGNvbnRleHQpLm9uKCdzdGF0aW86ZG9uZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmxpamF4LWRpc2FibGUnLCB0aGlzKS5yZW1vdmVDbGFzcygnbGlqYXgtZGlzYWJsZScpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJylcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnbGlqYXgtc2VuZGluZycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gJChjb250ZXh0KS52YWwoKSB8fCAkKGNvbnRleHQpLmF0dHIoJ2RhdGEtdmFsdWUnKSB8fCBudWxsO1xuICAgICAgICAgICAgICAgIGlmKCQoY29udGV4dCkuaXMoJzpjaGVja2JveCcpKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAkKGNvbnRleHQpLmlzKCc6Y2hlY2tlZCcpID8gMSA6IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKGJhY2tfdmFsdWUgPT0gdmFsdWUgJiYgJChjb250ZXh0KS5pcygnaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QnKSAmJiAhb25GaXJlKSByZXR1cm47XG4gICAgICAgICAgICAgICAgYmFja192YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge307XG4gICAgICAgICAgICAgICAgZGF0YVtuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCQoY29udGV4dCkuYXR0cignZGF0YS1xdWVyeScpKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciBhY3Rpb25fcXVlcnkgPSB1cmwucGFyc2UoYWN0aW9uKTtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YV9xdWVyeSA9IHVybC5wYXJzZSgnPycgKyAkKGNvbnRleHQpLmF0dHIoJ2RhdGEtcXVlcnknKSk7XG4gICAgICAgICAgICAgICAgYWN0aW9uX3F1ZXJ5LmdldCA9ICQuZXh0ZW5kKG51bGwsIChhY3Rpb25fcXVlcnkuZ2V0IHx8IHt9KSwgZGF0YV9xdWVyeS5nZXQpO1xuICAgICAgICAgICAgICAgIGFjdGlvbiA9IHVybC5idWlsZChhY3Rpb25fcXVlcnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSB7fTtcbiAgICAgICAgICAgIGlmICgkKGNvbnRleHQpLmF0dHIoJ2RhdGEteGhyQmFzZScpKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGhlYWRlcnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICdEYXRhLXhoci1iYXNlJzogJChjb250ZXh0KS5hdHRyKCdkYXRhLXhockJhc2UnKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuZXcgU3RhdGlvKHtcbiAgICAgICAgICAgICAgICB0eXBlIDogc3RhdGUgPyAnYm90aCcgOiAncmVuZGVyJyxcbiAgICAgICAgICAgICAgICBjb250ZXh0OiBjb250ZXh0LFxuICAgICAgICAgICAgICAgIGFqYXggOiB7XG5cdFx0XHRcdFx0Y29udGVudFR5cGU6ICQoY29udGV4dCkuaXMoJ2Zvcm0nKSAmJiAoJChjb250ZXh0KS5hdHRyKCdlbmN0eXBlJykgPT0gJ211bHRpcGFydC9mb3JtLWRhdGEnIHx8ICQoJ2lucHV0OmZpbGUnLCBjb250ZXh0KS5sZW5ndGgpID8gZmFsc2UgOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04Jyxcblx0XHRcdFx0XHRwcm9jZXNzRGF0YTogKCQoY29udGV4dCkuaXMoJ2Zvcm0nKSAmJiAoJChjb250ZXh0KS5hdHRyKCdlbmN0eXBlJykgPT0gJ211bHRpcGFydC9mb3JtLWRhdGEnIHx8ICQoJ2lucHV0OmZpbGUnLCBjb250ZXh0KS5sZW5ndGgpKSA/IGZhbHNlIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY2FjaGUgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kIDogbWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICBkYXRhIDogZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdXJsIDogYWN0aW9uXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob25GaXJlKVxuICAgICAgICB7XG4gICAgICAgICAgICBzZW5kKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgd2luZG93LkxpamF4ID0gbGlqYXg7XG59KSgpOyIsIihmdW5jdGlvbigpe1xuXHR2YXIgX2dsb2JhbHMgPSB7XG5cdFx0dGl0bGUgOiBmdW5jdGlvbiAodmFsdWUpe1xuXHRcdFx0JCgndGl0bGUnKS5odG1sKHZhbHVlKTtcblx0XHR9XG5cdH1cblxuXHR2YXIgX2FqYXggPSB7XG5cdFx0dHlwZSA6ICdHRVQnLFxuXHRcdGNhY2hlIDogZmFsc2Vcblx0fVxuXG5cdHZhciBfb3B0aW9ucyA9IHtcblx0XHRvYmplY3QgOiBudWxsLFxuXHRcdHRpdGxlIDogbnVsbCxcblx0XHRhamF4IDogX2FqYXgsXG5cdC8qKlxuXHQgKiBTZW5kIHJlcXVlc3QgYW5kIGNoYW5nZSB1cmwgd2l0aCByZXNwb25zZSByZW5kZXJpbmdcblx0ICogQGRlZmF1bHQgYm90aFxuXHQgKiBib3RoOiBjaGFuZ2UgdXJsIGFuZCByZW5kZXIgcmVzcG9uc2Vcblx0ICogdXJsOiBPbmx5IHNlbmQgcmVxdWVzdCBhbmQgY2hhZ2UgdXJsIHdpdGhvdXQgY2hhbmdlIHJlbmRlcmluZ1xuXHQgKiByZW5kZXI6IE9ubHkgc2VuZCByZXF1ZXN0IGFuZCByZW5kZXIgcmVwc29uc2Ugd2l0aG91dCBjaGFuZ2UgdXJsXG5cdCAqIEB0eXBlIHtTdHJpbmd9XG5cdCAqL1xuXHQgdHlwZSA6ICdib3RoJyxcblx0LyoqXG5cdCAqIGRvbnQgc2VuZCBhbnkgcmVxdWVzdFxuXHQgKiBAdHlwZSB7Qm9vbGVhbn1cblx0ICovXG5cdCBmYWtlIDogZmFsc2UsXG5cdC8qKlxuXHQgKiBhamF4IHJlc3BvbnNlIGNvbnRldG50XG5cdCAqIGlmIHtmYWtlOnRydWV9IG9yIHtyZXNwb25zZSA6IG5vdG51bGx9IHJlc3BvbnNlIHJlbmRlciB0aGlzIHByb3BlcnR5XG5cdCAqIEB0eXBlIHtbdHlwZV19XG5cdCAqL1xuXHQgcmVzcG9uc2UgOiBudWxsLFxuXHQvKipcblx0ICogcmVwbGFjZSBzdGF0ZVxuXHQgKiBAdHlwZSB7Qm9vbGVhbn1cblx0ICovXG5cdCByZXBsYWNlIDogZmFsc2UsXG5cdC8qKlxuXHQgKiBldmVudCBjb250ZXh0XG5cdCAqIEB0eXBlIHtET019IHtqUXVlcnl9IHtTZWxlY3RvciBzdHJpbmd9XG5cdCAqL1xuXHQgY29udGV4dCA6IGRvY3VtZW50XG5cdH1cblxuXHRmdW5jdGlvbiBzdGF0aW8oY3VzdG9tKXtcblx0XHRpZih0eXBlb2YgY3VzdG9tICE9ICdvYmplY3QnKVxuXHRcdHtcblx0XHRcdGN1c3RvbSA9IHt9O1xuXHRcdH1cblxuXHRcdGN1c3RvbS5hamF4ID0gJC5leHRlbmQoe30sIF9hamF4LCBjdXN0b20uYWpheCk7XG5cdFx0Y3VzdG9tLmFqYXgudXJsID0gY3VzdG9tLnVybDtcblx0XHRjdXN0b20uZ2xvYmFscyA9ICQuZXh0ZW5kKHt9LCBfZ2xvYmFscywgY3VzdG9tLmdsb2JhbHMpO1xuXHRcdHZhciBvcHRpb25zID0gJC5leHRlbmQoe30sIF9vcHRpb25zLCBjdXN0b20pO1xuXG5cdFx0dmFyIHJlc3BvbnNlID0ge1xuXHRcdFx0Ym9keSA6IG9wdGlvbnMucmVzcG9uc2UsXG5cdFx0XHRkYXRhIDoge30sXG5cdFx0fTtcblxuXHRcdGlmKCEob3B0aW9ucy5jb250ZXh0IGluc3RhbmNlb2YgalF1ZXJ5KSlcblx0XHR7XG5cdFx0XHRvcHRpb25zLmNvbnRleHQgPSAkKG9wdGlvbnMuY29udGV4dCk7XG5cdFx0fVxuXG5cdFx0JChkb2N1bWVudCkudHJpZ2dlcignc3RhdGlvOmdsb2JhbDppbml0JywgW29wdGlvbnMuY29udGV4dF0pO1xuXHRcdG9wdGlvbnMuY29udGV4dC50cmlnZ2VyKCdzdGF0aW86aW5pdCcpO1xuXG5cblx0XHR2YXIgYWpheF9kYXRhID0gbnVsbDtcblx0XHR2YXIgYWpheF9zZW5kX3VybCA9IG51bGw7XG5cdFx0aWYoIW9wdGlvbnMuZmFrZSlcblx0XHR7XG5cdFx0XHRpZighb3B0aW9ucy5hamF4LmNvbXBsZXRlKVxuXHRcdFx0e1xuXHRcdFx0XHRvcHRpb25zLmFqYXguY29tcGxldGUgPSBhanhfY29tcGxldGU7XG5cdFx0XHR9XG5cdFx0XHR2YXIgYmVmb3JlU2VuZCA9IG9wdGlvbnMuYWpheC5iZWZvcmVTZW5kO1xuXHRcdFx0b3B0aW9ucy5hamF4LmJlZm9yZVNlbmQgPSBmdW5jdGlvbihqcVhIUiwgc2V0dGluZ3MpXG5cdFx0XHR7XG5cdFx0XHRcdGFqYXhfZGF0YSA9IHRoaXM7XG5cdFx0XHRcdGFqYXhfc2VuZF91cmwgPSB0aGlzLnVybDtcblx0XHRcdFx0dmFyIHVybHggPSB1cmwucGFyc2UoYWpheF9zZW5kX3VybCk7XG5cdFx0XHRcdGlmKHVybHguZ2V0ICYmIHVybHguZ2V0Ll8pXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRkZWxldGUgdXJseC5nZXQuXztcblx0XHRcdFx0fVxuICAgICAgICAgICAgXHR2YXIgZ2V0ID0gdXJsLmJ1aWxkZ2V0KHVybHguZ2V0KTtcbiAgICAgICAgICAgIFx0YWpheF9zZW5kX3VybCA9IHVybHgudXJsLnJlcGxhY2UoL1xcPyguKikkLywgZ2V0ID8gJz8nICsgZ2V0IDogJycpO1xuXHRcdFx0XHRiZWZvcmVTZW5kID8gYmVmb3JlU2VuZC5jYWxsKHRoaXMsIGpxWEhSLCBzZXR0aW5ncykgOiBudWxsO1xuXHRcdFx0fVxuXHRcdFx0JC5hamF4KG9wdGlvbnMuYWpheCk7XG5cdFx0fVxuXHRcdGVsc2UgaWYob3B0aW9ucy50eXBlICE9ICd1cmwnICYmIHJlc3BvbnNlLmJvZHkpXG5cdFx0e1xuXHRcdFx0cmVzcG9uc2VfcGFyc2UoKTtcblx0XHRcdHJlbmRlcigpO1xuXHRcdFx0JChkb2N1bWVudCkudHJpZ2dlcignc3RhdGlvOmdsb2JhbDpkb25lJywgW29wdGlvbnMuY29udGV4dF0pO1xuXHRcdFx0b3B0aW9ucy5jb250ZXh0LnRyaWdnZXIoJ3N0YXRpbzpkb25lJyk7XG5cdFx0fVxuXHRcdGVsc2Vcblx0XHR7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRvcHRpb25zLnJlcGxhY2Vcblx0XHRcdFx0XHQ/IGhpc3RvcnkucmVwbGFjZVN0YXRlKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob3B0aW9ucykpLCBvcHRpb25zLnRpdGxlLCBhamF4X3NlbmRfdXJsIHx8IG9wdGlvbnMudXJsKVxuXHRcdFx0XHRcdDogaGlzdG9yeS5wdXNoU3RhdGUoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvcHRpb25zKSksIG9wdGlvbnMudGl0bGUsIGFqYXhfc2VuZF91cmwgfHwgb3B0aW9ucy51cmwpO1xuXHRcdFx0fVxuXHRcdFx0Y2F0Y2ggKGUpIHtcblx0XHRcdFx0Y29uc29sZS5lcnJvcihlKTtcblx0XHRcdH1cblx0XHRcdCQoZG9jdW1lbnQpLnRyaWdnZXIoJ3N0YXRpbzpnbG9iYWw6ZG9uZScsIFtvcHRpb25zLmNvbnRleHRdKTtcblx0XHRcdG9wdGlvbnMuY29udGV4dC50cmlnZ2VyKCdzdGF0aW86ZG9uZScpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGFqeF9jb21wbGV0ZShqcVhIUiwgdGV4dFN0YXR1cylcblx0XHR7XG5cdFx0XHRpZihqcVhIUi5yZXNwb25zZUpTT04pXG5cdFx0XHR7XG5cdFx0XHRcdHJlc3BvbnNlLmRhdGEgPSBqcVhIUi5yZXNwb25zZUpTT047XG5cdFx0XHRcdCQoZG9jdW1lbnQpLnRyaWdnZXIoJ3N0YXRpbzpnbG9iYWw6anNvblJlc3BvbnNlJywgW29wdGlvbnMuY29udGV4dCwganFYSFIucmVzcG9uc2VKU09OLCBqcVhIUl0pO1xuXHRcdFx0XHRvcHRpb25zLmNvbnRleHQudHJpZ2dlcignc3RhdGlvOmpzb25SZXNwb25zZScsIFtqcVhIUi5yZXNwb25zZUpTT04sIGpxWEhSXSk7XG5cdFx0XHRcdG5ldyBKUmVzcChvcHRpb25zLmNvbnRleHQsIHJlc3BvbnNlLmRhdGEpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHRyZXNwb25zZS5ib2R5ID0ganFYSFIucmVzcG9uc2VUZXh0O1xuXHRcdFx0XHRyZXNwb25zZV9wYXJzZSgpO1xuXHRcdFx0XHRpZih0ZXh0U3RhdHVzID09ICdzdWNjZXNzJylcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGlmIChvcHRpb25zLnR5cGUgIT0gJ3JlbmRlcicpIHtcblx0XHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRcdG9wdGlvbnMucmVzcG9uc2UgPSByZXNwb25zZTtcblx0XHRcdFx0XHRcdFx0b3B0aW9ucy5yZXBsYWNlXG5cdFx0XHRcdFx0XHRcdFx0PyBoaXN0b3J5LnJlcGxhY2VTdGF0ZShKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9wdGlvbnMpKSwgb3B0aW9ucy50aXRsZSwgYWpheF9zZW5kX3VybCB8fCBvcHRpb25zLnVybClcblx0XHRcdFx0XHRcdFx0XHQ6IGhpc3RvcnkucHVzaFN0YXRlKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob3B0aW9ucykpLCBvcHRpb25zLnRpdGxlLCBhamF4X3NlbmRfdXJsIHx8IG9wdGlvbnMudXJsKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGNhdGNoIChlKSB7XG5cdFx0XHRcdFx0XHRcdHRyeXtcblx0XHRcdFx0XHRcdFx0XHRvcHRpb25zLnJlcGxhY2Vcblx0XHRcdFx0XHRcdFx0XHRcdD8gaGlzdG9yeS5yZXBsYWNlU3RhdGUob3B0aW9ucy5kYXRhLCBvcHRpb25zLnRpdGxlLCBhamF4X3NlbmRfdXJsIHx8IG9wdGlvbnMudXJsKVxuXHRcdFx0XHRcdFx0XHRcdFx0OiBoaXN0b3J5LnB1c2hTdGF0ZShvcHRpb25zLmRhdGEsIG9wdGlvbnMudGl0bGUsIGFqYXhfc2VuZF91cmwgfHwgb3B0aW9ucy51cmwpO1xuXG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0Y2F0Y2ggKGUpe1xuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoZSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0JChkb2N1bWVudCkudHJpZ2dlcignc3RhdGlvOmdsb2JhbDpzdWNjZXNzJywgW29wdGlvbnMuY29udGV4dCwgcmVzcG9uc2UuZGF0YSwgcmVzcG9uc2UuYm9keSwganFYSFJdKTtcblx0XHRcdFx0XHRvcHRpb25zLmNvbnRleHQudHJpZ2dlcignc3RhdGlvOnN1Y2Nlc3MnLCBbcmVzcG9uc2UuZGF0YSwgcmVzcG9uc2UuYm9keSwganFYSFJdKTtcblx0XHRcdFx0XHRpZihvcHRpb25zLnR5cGUgIT0gJ3VybCcpXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0cmVuZGVyKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0e1xuXHRcdFx0XHRcdCQoZG9jdW1lbnQpLnRyaWdnZXIoJ3N0YXRpbzpnbG9iYWw6ZXJyb3JSZXNwb25zZScsIFtvcHRpb25zLmNvbnRleHQsIHJlc3BvbnNlLmRhdGEsIHJlc3BvbnNlLmJvZHksIGpxWEhSXSk7XG5cdFx0XHRcdFx0b3B0aW9ucy5jb250ZXh0LnRyaWdnZXIoJ3N0YXRpbzplcnJvclJlc3BvbnNlJywgW3Jlc3BvbnNlLmRhdGEsIHJlc3BvbnNlLmJvZHksIGpxWEhSXSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdCQoZG9jdW1lbnQpLnRyaWdnZXIoJ3N0YXRpbzpnbG9iYWw6ZG9uZScsIFtvcHRpb25zLmNvbnRleHQsIHJlc3BvbnNlLmRhdGEsIHJlc3BvbnNlLmJvZHksIGpxWEhSXSk7XG5cdFx0XHRvcHRpb25zLmNvbnRleHQudHJpZ2dlcignc3RhdGlvOmRvbmUnLCBbcmVzcG9uc2UuZGF0YSwgcmVzcG9uc2UuYm9keSwganFYSFJdKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiByZXNwb25zZV9wYXJzZSgpe1xuXHRcdFx0aWYodHlwZW9mIHJlc3BvbnNlLmJvZHkgPT0gJ3N0cmluZycpXG5cdFx0XHR7XG5cdFx0XHRcdHRyeVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dmFyIHNwbGl0ICAgICA9IHJlc3BvbnNlLmJvZHkuc3BsaXQoXCJcXG5cIik7XG5cdFx0XHRcdFx0cmVzcG9uc2UuZGF0YSA9IEpTT04ucGFyc2Uoc3BsaXRbMF0pO1xuXHRcdFx0XHRcdHJlc3BvbnNlLmJvZHkgPSBzcGxpdC5sZW5ndGggPiAxID8gJCgkLnBhcnNlSFRNTChzcGxpdC5zcGxpY2UoMSkuam9pbihcIlwiKSkpIDogbnVsbDtcblx0XHRcdFx0fWNhdGNoKGUpe1xuXHRcdFx0XHRcdHJlc3BvbnNlLmJvZHkgID0gJCgkLnBhcnNlSFRNTChyZXNwb25zZS5ib2R5KSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGVsc2UgaWYodHlwZW9mIHJlc3BvbnNlLmJvZHkgPT0gJ29iamVjdCcgJiYgcmVzcG9uc2UuYm9keSAhPSBudWxsKVxuXHRcdFx0e1xuXHRcdFx0XHRpZihyZXNwb25zZS5ib2R5IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRyZXNwb25zZS5ib2R5ICA9ICQocmVzcG9uc2UuYm9keSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZSBpZihyZXNwb25zZS5ib2R5IGluc3RhbmNlb2YgalF1ZXJ5KVxuXHRcdFx0XHR7XG5cblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRyZXNwb25zZS5kYXRhID0gcmVzcG9uc2UuYm9keTtcblx0XHRcdFx0XHRyZXNwb25zZS5ib2R5ID0gbnVsbDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHJlbmRlcigpe1xuXHRcdFx0Zm9yKEQgaW4gcmVzcG9uc2UuZGF0YSlcblx0XHRcdHtcblx0XHRcdFx0aWYob3B0aW9ucy5nbG9iYWxzW0RdKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0b3B0aW9ucy5nbG9iYWxzW0RdKHJlc3BvbnNlLmRhdGFbRF0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRpZihyZXNwb25zZS5ib2R5KVxuXHRcdFx0e1xuXHRcdFx0XHR2YXIgY2hhbmdlZCA9IFtdO1xuXHRcdFx0XHRyZXNwb25zZS5ib2R5LmVhY2goZnVuY3Rpb24oKXtcblx0XHRcdFx0XHR2YXIgYmFzZSA9ICQodGhpcykuYXR0cignZGF0YS14aHInKTtcblx0XHRcdFx0XHRpZihiYXNlKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdGNoYW5nZWQucHVzaCgkKFwiW2RhdGEteGhyPSdcIitiYXNlK1wiJ11cIikpO1xuXHRcdFx0XHRcdFx0JChcIltkYXRhLXhocj0nXCIrYmFzZStcIiddXCIpLmh0bWwoJCh0aGlzKS5odG1sKCkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdCQoZG9jdW1lbnQpLnRyaWdnZXIoJ3N0YXRpbzpnbG9iYWw6cmVuZGVyUmVzcG9uc2UnLCBbJChjaGFuZ2VkKSwgb3B0aW9ucy5jb250ZXh0LCByZXNwb25zZS5kYXRhLCByZXNwb25zZS5ib2R5XSk7XG5cdFx0XHRcdG9wdGlvbnMuY29udGV4dC50cmlnZ2VyKCdzdGF0aW86cmVuZGVyUmVzcG9uc2UnLCBbJChjaGFuZ2VkKSwgcmVzcG9uc2UuZGF0YSwgcmVzcG9uc2UuYm9keV0pO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXHR3aW5kb3cuU3RhdGlvID0gc3RhdGlvO1xuXHQvKipcblx0ICogZm9yIG5ldyBjaHJvbWUgYnVnXG5cdCAqL1xuXHQgbmV3IFN0YXRpbyh7XG5cdCBcdHVybCA6IGxvY2F0aW9uLmhyZWYsXG5cdCBcdGZha2UgOiB0cnVlLFxuXHQgXHRyZXBsYWNlIDogdHJ1ZVxuXHQgfSk7XG5cblx0LyoqXG5cdCAqIHBvcHN0YXRlIGV2ZW50XG5cdCAqL1xuXHQgd2luZG93Lm9ucG9wc3RhdGUgPSBmdW5jdGlvbihldmVudCl7XG5cdCBcdG5ldyBTdGF0aW8oe1xuXHQgXHRcdHVybCA6IGxvY2F0aW9uLmhyZWYsXG5cdCBcdFx0cmVwbGFjZSA6IHRydWVcblx0IFx0fSk7XG5cdCB9O1xufSkoKTsiLCJcbi8vIENvcHlyaWdodCAyMDEzLTIwMTQgS2V2aW4gQ294XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuKiAgVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQgICAgICAgICAgICpcbiogIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcyAgICAgICAqXG4qICBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiogIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLCAgICAgICAqXG4qICBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0ICAgICAgKlxuKiAgZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqXG4qICAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdCAgICAgKlxuKiAgICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUgaW4gICpcbiogICAgIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZSAgICAgICAqXG4qICAgICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiogIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlICAqXG4qICAgICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiogIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uICAqXG4qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuK2Z1bmN0aW9uKCl7XG5cInVzZSBzdHJpY3RcIjtcblxudmFyIGFycmF5ID0gL1xcWyhbXlxcW10qKVxcXSQvO1xuXG4vLy8gVVJMIFJlZ2V4LlxuLyoqXG4gKiBUaGlzIHJlZ2V4IHNwbGl0cyB0aGUgVVJMIGludG8gcGFydHMuICBUaGUgY2FwdHVyZSBncm91cHMgY2F0Y2ggdGhlIGltcG9ydGFudFxuICogYml0cy5cbiAqXG4gKiBFYWNoIHNlY3Rpb24gaXMgb3B0aW9uYWwsIHNvIHRvIHdvcmsgb24gYW55IHBhcnQgZmluZCB0aGUgY29ycmVjdCB0b3AgbGV2ZWxcbiAqIGAoLi4uKT9gIGFuZCBtZXNzIGFyb3VuZCB3aXRoIGl0LlxuICovXG52YXIgcmVnZXggPSAvXig/OihbYS16XSopOik/KD86XFwvXFwvKT8oPzooW146QF0qKSg/OjooW15AXSopKT9AKT8oWzAtOWEtei0uX10rKT8oPzo6KFswLTldKikpPyhcXC9bXj8jXSopPyg/OlxcPyhbXiNdKikpPyg/OiMoLiopKT8kL2k7XG4vLyAgICAgICAgICAgICAgIDEgLSBzY2hlbWUgICAgICAgICAgICAgIDIgLSB1c2VyICAgIDMgPSBwYXNzICAgIDQgLSBob3N0ICAgICAgICAgICA1IC0gcG9ydCAgNiAtIHBhdGggICAgICAgIDcgLSBxdWVyeSAgICA4IC0gaGFzaFxuXG52YXIgbm9zbGFzaCA9IFtcIm1haWx0b1wiLFwiYml0Y29pblwiXTtcblxudmFyIHNlbGYgPSB7XG5cdC8qKiBQYXJzZSBhIHF1ZXJ5IHN0cmluZy5cblx0ICpcblx0ICogVGhpcyBmdW5jdGlvbiBwYXJzZXMgYSBxdWVyeSBzdHJpbmcgKHNvbWV0aW1lcyBjYWxsZWQgdGhlIHNlYXJjaFxuXHQgKiBzdHJpbmcpLiAgSXQgdGFrZXMgYSBxdWVyeSBzdHJpbmcgYW5kIHJldHVybnMgYSBtYXAgb2YgdGhlIHJlc3VsdHMuXG5cdCAqXG5cdCAqIEtleXMgYXJlIGNvbnNpZGVyZWQgdG8gYmUgZXZlcnl0aGluZyB1cCB0byB0aGUgZmlyc3QgJz0nIGFuZCB2YWx1ZXMgYXJlXG5cdCAqIGV2ZXJ5dGhpbmcgYWZ0ZXJ3b3Jkcy4gIFNpbmNlIFVSTC1kZWNvZGluZyBpcyBkb25lIGFmdGVyIHBhcnNpbmcsIGtleXNcblx0ICogYW5kIHZhbHVlcyBjYW4gaGF2ZSBhbnkgdmFsdWVzLCBob3dldmVyLCAnPScgaGF2ZSB0byBiZSBlbmNvZGVkIGluIGtleXNcblx0ICogd2hpbGUgJz8nIGFuZCAnJicgaGF2ZSB0byBiZSBlbmNvZGVkIGFueXdoZXJlIChhcyB0aGV5IGRlbGltaXQgdGhlXG5cdCAqIGt2LXBhaXJzKS5cblx0ICpcblx0ICogS2V5cyBhbmQgdmFsdWVzIHdpbGwgYWx3YXlzIGJlIHN0cmluZ3MsIGV4Y2VwdCBpZiB0aGVyZSBpcyBhIGtleSB3aXRoIG5vXG5cdCAqICc9JyBpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgY29uc2lkZXJlZCBhIGZsYWcgYW5kIHdpbGwgYmUgc2V0IHRvIHRydWUuXG5cdCAqIExhdGVyIHZhbHVlcyB3aWxsIG92ZXJyaWRlIGVhcmxpZXIgdmFsdWVzLlxuXHQgKlxuXHQgKiBBcnJheSBrZXlzIGFyZSBhbHNvIHN1cHBvcnRlZC4gIEJ5IGRlZmF1bHQga2V5cyBpbiB0aGUgZm9ybSBvZiBgbmFtZVtpXWBcblx0ICogd2lsbCBiZSByZXR1cm5lZCBsaWtlIHRoYXQgYXMgc3RyaW5ncy4gIEhvd2V2ZXIsIGlmIHlvdSBzZXQgdGhlIGBhcnJheWBcblx0ICogZmxhZyBpbiB0aGUgb3B0aW9ucyBvYmplY3QgdGhleSB3aWxsIGJlIHBhcnNlZCBpbnRvIGFycmF5cy4gIE5vdGUgdGhhdFxuXHQgKiBhbHRob3VnaCB0aGUgb2JqZWN0IHJldHVybmVkIGlzIGFuIGBBcnJheWAgb2JqZWN0IGFsbCBrZXlzIHdpbGwgYmVcblx0ICogd3JpdHRlbiB0byBpdC4gIFRoaXMgbWVhbnMgdGhhdCBpZiB5b3UgaGF2ZSBhIGtleSBzdWNoIGFzIGBrW2ZvckVhY2hdYFxuXHQgKiBpdCB3aWxsIG92ZXJ3cml0ZSB0aGUgYGZvckVhY2hgIGZ1bmN0aW9uIG9uIHRoYXQgYXJyYXkuICBBbHNvIG5vdGUgdGhhdFxuXHQgKiBzdHJpbmcgcHJvcGVydGllcyBhbHdheXMgdGFrZSBwcmVjZWRlbmNlIG92ZXIgYXJyYXkgcHJvcGVydGllcyxcblx0ICogaXJyZXNwZWN0aXZlIG9mIHdoZXJlIHRoZXkgYXJlIGluIHRoZSBxdWVyeSBzdHJpbmcuXG5cdCAqXG5cdCAqICAgdXJsLmdldChcImFycmF5WzFdPXRlc3QmYXJyYXlbZm9vXT1iYXJcIix7YXJyYXk6dHJ1ZX0pLmFycmF5WzFdICA9PT0gXCJ0ZXN0XCJcblx0ICogICB1cmwuZ2V0KFwiYXJyYXlbMV09dGVzdCZhcnJheVtmb29dPWJhclwiLHthcnJheTp0cnVlfSkuYXJyYXkuZm9vID09PSBcImJhclwiXG5cdCAqICAgdXJsLmdldChcImFycmF5PW5vdGFuYXJyYXkmYXJyYXlbMF09MVwiLHthcnJheTp0cnVlfSkuYXJyYXkgICAgICA9PT0gXCJub3RhbmFycmF5XCJcblx0ICpcblx0ICogSWYgYXJyYXkgcGFyc2luZyBpcyBlbmFibGVkIGtleXMgaW4gdGhlIGZvcm0gb2YgYG5hbWVbXWAgd2lsbFxuXHQgKiBhdXRvbWF0aWNhbGx5IGJlIGdpdmVuIHRoZSBuZXh0IGF2YWlsYWJsZSBpbmRleC4gIE5vdGUgdGhhdCB0aGlzIGNhbiBiZVxuXHQgKiBvdmVyd3JpdHRlbiB3aXRoIGxhdGVyIHZhbHVlcyBpbiB0aGUgcXVlcnkgc3RyaW5nLiAgRm9yIHRoaXMgcmVhc29uIGlzXG5cdCAqIGlzIGJlc3Qgbm90IHRvIG1peCB0aGUgdHdvIGZvcm1hdHMsIGFsdGhvdWdoIGl0IGlzIHNhZmUgKGFuZCBvZnRlblxuXHQgKiB1c2VmdWwpIHRvIGFkZCBhbiBhdXRvbWF0aWMgaW5kZXggYXJndW1lbnQgdG8gdGhlIGVuZCBvZiBhIHF1ZXJ5IHN0cmluZy5cblx0ICpcblx0ICogICB1cmwuZ2V0KFwiYVtdPTAmYVtdPTEmYVswXT0yXCIsIHthcnJheTp0cnVlfSkgIC0+IHthOltcIjJcIixcIjFcIl19O1xuXHQgKiAgIHVybC5nZXQoXCJhWzBdPTAmYVsxXT0xJmFbXT0yXCIsIHthcnJheTp0cnVlfSkgLT4ge2E6W1wiMFwiLFwiMVwiLFwiMlwiXX07XG5cdCAqXG5cdCAqIEBwYXJhbXtzdHJpbmd9IHEgVGhlIHF1ZXJ5IHN0cmluZyAodGhlIHBhcnQgYWZ0ZXIgdGhlICc/JykuXG5cdCAqIEBwYXJhbXt7ZnVsbDpib29sZWFuLGFycmF5OmJvb2xlYW59PX0gb3B0IE9wdGlvbnMuXG5cdCAqXG5cdCAqIC0gZnVsbDogSWYgc2V0IGBxYCB3aWxsIGJlIHRyZWF0ZWQgYXMgYSBmdWxsIHVybCBhbmQgYHFgIHdpbGwgYmUgYnVpbHQuXG5cdCAqICAgYnkgY2FsbGluZyAjcGFyc2UgdG8gcmV0cmlldmUgdGhlIHF1ZXJ5IHBvcnRpb24uXG5cdCAqIC0gYXJyYXk6IElmIHNldCBrZXlzIGluIHRoZSBmb3JtIG9mIGBrZXlbaV1gIHdpbGwgYmUgdHJlYXRlZFxuXHQgKiAgIGFzIGFycmF5cy9tYXBzLlxuXHQgKlxuXHQgKiBAcmV0dXJueyFPYmplY3QuPHN0cmluZywgc3RyaW5nfEFycmF5Pn0gVGhlIHBhcnNlZCByZXN1bHQuXG5cdCAqL1xuXHRcImdldFwiOiBmdW5jdGlvbihxLCBvcHQpe1xuXHRcdHEgPSBxIHx8IFwiXCI7XG5cdFx0aWYgKCB0eXBlb2Ygb3B0ICAgICAgICAgID09IFwidW5kZWZpbmVkXCIgKSBvcHQgPSB7fTtcblx0XHRpZiAoIHR5cGVvZiBvcHRbXCJmdWxsXCJdICA9PSBcInVuZGVmaW5lZFwiICkgb3B0W1wiZnVsbFwiXSA9IGZhbHNlO1xuXHRcdGlmICggdHlwZW9mIG9wdFtcImFycmF5XCJdID09IFwidW5kZWZpbmVkXCIgKSBvcHRbXCJhcnJheVwiXSA9IGZhbHNlO1xuXG5cdFx0aWYgKCBvcHRbXCJmdWxsXCJdID09PSB0cnVlIClcblx0XHR7XG5cdFx0XHRxID0gc2VsZltcInBhcnNlXCJdKHEsIHtcImdldFwiOmZhbHNlfSlbXCJxdWVyeVwiXSB8fCBcIlwiO1xuXHRcdH1cblxuXHRcdHZhciBvID0ge307XG5cblx0XHR2YXIgYyA9IHEuc3BsaXQoXCImXCIpO1xuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgYy5sZW5ndGg7IGkrKylcblx0XHR7XG5cdFx0XHRpZiAoIWNbaV0ubGVuZ3RoKSBjb250aW51ZTtcblxuXHRcdFx0dmFyIGQgPSBjW2ldLmluZGV4T2YoXCI9XCIpO1xuXHRcdFx0dmFyIGsgPSBjW2ldLCB2ID0gdHJ1ZTtcblx0XHRcdGlmICggZCA+PSAwIClcblx0XHRcdHtcblx0XHRcdFx0ayA9IGNbaV0uc3Vic3RyKDAsIGQpO1xuXHRcdFx0XHR2ID0gY1tpXS5zdWJzdHIoZCsxKTtcblxuXHRcdFx0XHR2ID0gZGVjb2RlVVJJQ29tcG9uZW50KHYpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAob3B0W1wiYXJyYXlcIl0pXG5cdFx0XHR7XG5cdFx0XHRcdHZhciBpbmRzID0gW107XG5cdFx0XHRcdHZhciBpbmQ7XG5cdFx0XHRcdHZhciBjdXJvID0gbztcblx0XHRcdFx0dmFyIGN1cmsgPSBrO1xuXHRcdFx0XHR3aGlsZSAoaW5kID0gY3Vyay5tYXRjaChhcnJheSkpIC8vIEFycmF5IVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Y3VyayA9IGN1cmsuc3Vic3RyKDAsIGluZC5pbmRleCk7XG5cdFx0XHRcdFx0aW5kcy51bnNoaWZ0KGRlY29kZVVSSUNvbXBvbmVudChpbmRbMV0pKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRjdXJrID0gZGVjb2RlVVJJQ29tcG9uZW50KGN1cmspO1xuXHRcdFx0XHRpZiAoaW5kcy5zb21lKGZ1bmN0aW9uKGkpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRpZiAoIHR5cGVvZiBjdXJvW2N1cmtdID09IFwidW5kZWZpbmVkXCIgKSBjdXJvW2N1cmtdID0gW107XG5cdFx0XHRcdFx0aWYgKCFBcnJheS5pc0FycmF5KGN1cm9bY3Vya10pKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdC8vY29uc29sZS5sb2coXCJ1cmwuZ2V0OiBBcnJheSBwcm9wZXJ0eSBcIitjdXJrK1wiIGFscmVhZHkgZXhpc3RzIGFzIHN0cmluZyFcIik7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjdXJvID0gY3Vyb1tjdXJrXTtcblxuXHRcdFx0XHRcdGlmICggaSA9PT0gXCJcIiApIGkgPSBjdXJvLmxlbmd0aDtcblxuXHRcdFx0XHRcdGN1cmsgPSBpO1xuXHRcdFx0XHR9KSkgY29udGludWU7XG5cdFx0XHRcdGN1cm9bY3Vya10gPSB2O1xuXHRcdFx0XHRjb250aW51ZTtcblx0XHRcdH1cblxuXHRcdFx0ayA9IGRlY29kZVVSSUNvbXBvbmVudChrKTtcblxuXHRcdFx0Ly90eXBlb2Ygb1trXSA9PSBcInVuZGVmaW5lZFwiIHx8IGNvbnNvbGUubG9nKFwiUHJvcGVydHkgXCIraytcIiBhbHJlYWR5IGV4aXN0cyFcIik7XG5cdFx0XHRvW2tdID0gdjtcblx0XHR9XG5cblx0XHRyZXR1cm4gbztcblx0fSxcblxuXHQvKiogQnVpbGQgYSBnZXQgcXVlcnkgZnJvbSBhbiBvYmplY3QuXG5cdCAqXG5cdCAqIFRoaXMgY29uc3RydWN0cyBhIHF1ZXJ5IHN0cmluZyBmcm9tIHRoZSBrdiBwYWlycyBpbiBgZGF0YWAuICBDYWxsaW5nXG5cdCAqICNnZXQgb24gdGhlIHN0cmluZyByZXR1cm5lZCBzaG91bGQgcmV0dXJuIGFuIG9iamVjdCBpZGVudGljYWwgdG8gdGhlIG9uZVxuXHQgKiBwYXNzZWQgaW4gZXhjZXB0IGFsbCBub24tYm9vbGVhbiBzY2FsYXIgdHlwZXMgYmVjb21lIHN0cmluZ3MgYW5kIGFsbFxuXHQgKiBvYmplY3QgdHlwZXMgYmVjb21lIGFycmF5cyAobm9uLWludGVnZXIga2V5cyBhcmUgc3RpbGwgcHJlc2VudCwgc2VlXG5cdCAqICNnZXQncyBkb2N1bWVudGF0aW9uIGZvciBtb3JlIGRldGFpbHMpLlxuXHQgKlxuXHQgKiBUaGlzIGFsd2F5cyB1c2VzIGFycmF5IHN5bnRheCBmb3IgZGVzY3JpYmluZyBhcnJheXMuICBJZiB5b3Ugd2FudCB0b1xuXHQgKiBzZXJpYWxpemUgdGhlbSBkaWZmZXJlbnRseSAobGlrZSBoYXZpbmcgdGhlIHZhbHVlIGJlIGEgSlNPTiBhcnJheSBhbmRcblx0ICogaGF2ZSBhIHBsYWluIGtleSkgeW91IHdpbGwgbmVlZCB0byBkbyB0aGF0IGJlZm9yZSBwYXNzaW5nIGl0IGluLlxuXHQgKlxuXHQgKiBBbGwga2V5cyBhbmQgdmFsdWVzIGFyZSBzdXBwb3J0ZWQgKGJpbmFyeSBkYXRhIGFueW9uZT8pIGFzIHRoZXkgYXJlXG5cdCAqIHByb3Blcmx5IFVSTC1lbmNvZGVkIGFuZCAjZ2V0IHByb3Blcmx5IGRlY29kZXMuXG5cdCAqXG5cdCAqIEBwYXJhbXtPYmplY3R9IGRhdGEgVGhlIGt2IHBhaXJzLlxuXHQgKiBAcGFyYW17c3RyaW5nfSBwcmVmaXggVGhlIHByb3Blcmx5IGVuY29kZWQgYXJyYXkga2V5IHRvIHB1dCB0aGVcblx0ICogICBwcm9wZXJ0aWVzLiAgTWFpbmx5IGludGVuZGVkIGZvciBpbnRlcm5hbCB1c2UuXG5cdCAqIEByZXR1cm57c3RyaW5nfSBBIFVSTC1zYWZlIHN0cmluZy5cblx0ICovXG5cdFwiYnVpbGRnZXRcIjogZnVuY3Rpb24oZGF0YSwgcHJlZml4KXtcblx0XHR2YXIgaXRtcyA9IFtdO1xuXHRcdGZvciAoIHZhciBrIGluIGRhdGEgKVxuXHRcdHtcblx0XHRcdHZhciBlayA9IGVuY29kZVVSSUNvbXBvbmVudChrKTtcblx0XHRcdGlmICggdHlwZW9mIHByZWZpeCAhPSBcInVuZGVmaW5lZFwiIClcblx0XHRcdFx0ZWsgPSBwcmVmaXgrXCJbXCIrZWsrXCJdXCI7XG5cblx0XHRcdHZhciB2ID0gZGF0YVtrXTtcblxuXHRcdFx0c3dpdGNoICh0eXBlb2Ygdilcblx0XHRcdHtcblx0XHRcdFx0Y2FzZSAnYm9vbGVhbic6XG5cdFx0XHRcdFx0aWYodikgaXRtcy5wdXNoKGVrKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSAnbnVtYmVyJzpcblx0XHRcdFx0XHR2ID0gdi50b1N0cmluZygpO1xuXHRcdFx0XHRjYXNlICdzdHJpbmcnOlxuXHRcdFx0XHRcdGl0bXMucHVzaChlaytcIj1cIitlbmNvZGVVUklDb21wb25lbnQodikpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlICdvYmplY3QnOlxuXHRcdFx0XHRcdGl0bXMucHVzaChzZWxmW1wiYnVpbGRnZXRcIl0odiwgZWspKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIGl0bXMuam9pbihcIiZcIik7XG5cdH0sXG5cblx0LyoqIFBhcnNlIGEgVVJMXG5cdCAqXG5cdCAqIFRoaXMgYnJlYWtzIHVwIGEgVVJMIGludG8gY29tcG9uZW50cy4gIEl0IGF0dGVtcHRzIHRvIGJlIHZlcnkgbGliZXJhbFxuXHQgKiBhbmQgcmV0dXJucyB0aGUgYmVzdCByZXN1bHQgaW4gbW9zdCBjYXNlcy4gIFRoaXMgbWVhbnMgdGhhdCB5b3UgY2FuXG5cdCAqIG9mdGVuIHBhc3MgaW4gcGFydCBvZiBhIFVSTCBhbmQgZ2V0IGNvcnJlY3QgY2F0ZWdvcmllcyBiYWNrLiAgTm90YWJseSxcblx0ICogdGhpcyB3b3JrcyBmb3IgZW1haWxzIGFuZCBKYWJiZXIgSURzLCBhcyB3ZWxsIGFzIGFkZGluZyBhICc/JyB0byB0aGVcblx0ICogYmVnaW5uaW5nIG9mIGEgc3RyaW5nIHdpbGwgcGFyc2UgdGhlIHdob2xlIHRoaW5nIGFzIGEgcXVlcnkgc3RyaW5nLiAgSWZcblx0ICogYW4gaXRlbSBpcyBub3QgZm91bmQgdGhlIHByb3BlcnR5IHdpbGwgYmUgdW5kZWZpbmVkLiAgSW4gc29tZSBjYXNlcyBhblxuXHQgKiBlbXB0eSBzdHJpbmcgd2lsbCBiZSByZXR1cm5lZCBpZiB0aGUgc3Vycm91bmRpbmcgc3ludGF4IGJ1dCB0aGUgYWN0dWFsXG5cdCAqIHZhbHVlIGlzIGVtcHR5IChleGFtcGxlOiBcIjovL2V4YW1wbGUuY29tXCIgd2lsbCBnaXZlIGEgZW1wdHkgc3RyaW5nIGZvclxuXHQgKiBzY2hlbWUuKSAgTm90YWJseSB0aGUgaG9zdCBuYW1lIHdpbGwgYWx3YXlzIGJlIHNldCB0byBzb21ldGhpbmcuXG5cdCAqXG5cdCAqIFJldHVybmVkIHByb3BlcnRpZXMuXG5cdCAqXG5cdCAqIC0gKipzY2hlbWU6KiogVGhlIHVybCBzY2hlbWUuIChleDogXCJtYWlsdG9cIiBvciBcImh0dHBzXCIpXG5cdCAqIC0gKip1c2VyOioqIFRoZSB1c2VybmFtZS5cblx0ICogLSAqKnBhc3M6KiogVGhlIHBhc3N3b3JkLlxuXHQgKiAtICoqaG9zdDoqKiBUaGUgaG9zdG5hbWUuIChleDogXCJsb2NhbGhvc3RcIiwgXCIxMjMuNDU2LjcuOFwiIG9yIFwiZXhhbXBsZS5jb21cIilcblx0ICogLSAqKnBvcnQ6KiogVGhlIHBvcnQsIGFzIGEgbnVtYmVyLiAoZXg6IDEzMzcpXG5cdCAqIC0gKipwYXRoOioqIFRoZSBwYXRoLiAoZXg6IFwiL1wiIG9yIFwiL2Fib3V0Lmh0bWxcIilcblx0ICogLSAqKnF1ZXJ5OioqIFwiVGhlIHF1ZXJ5IHN0cmluZy4gKGV4OiBcImZvbz1iYXImdj0xNyZmb3JtYXQ9anNvblwiKVxuXHQgKiAtICoqZ2V0OioqIFRoZSBxdWVyeSBzdHJpbmcgcGFyc2VkIHdpdGggZ2V0LiAgSWYgYG9wdC5nZXRgIGlzIGBmYWxzZWAgdGhpc1xuXHQgKiAgIHdpbGwgYmUgYWJzZW50XG5cdCAqIC0gKipoYXNoOioqIFRoZSB2YWx1ZSBhZnRlciB0aGUgaGFzaC4gKGV4OiBcIm15YW5jaG9yXCIpXG5cdCAqICAgYmUgdW5kZWZpbmVkIGV2ZW4gaWYgYHF1ZXJ5YCBpcyBzZXQuXG5cdCAqXG5cdCAqIEBwYXJhbXtzdHJpbmd9IHVybCBUaGUgVVJMIHRvIHBhcnNlLlxuXHQgKiBAcGFyYW17e2dldDpPYmplY3R9PX0gb3B0IE9wdGlvbnM6XG5cdCAqXG5cdCAqIC0gZ2V0OiBBbiBvcHRpb25zIGFyZ3VtZW50IHRvIGJlIHBhc3NlZCB0byAjZ2V0IG9yIGZhbHNlIHRvIG5vdCBjYWxsICNnZXQuXG5cdCAqICAgICoqRE8gTk9UKiogc2V0IGBmdWxsYC5cblx0ICpcblx0ICogQHJldHVybnshT2JqZWN0fSBBbiBvYmplY3Qgd2l0aCB0aGUgcGFyc2VkIHZhbHVlcy5cblx0ICovXG5cdFwicGFyc2VcIjogZnVuY3Rpb24odXJsLCBvcHQpIHtcblxuXHRcdGlmICggdHlwZW9mIG9wdCA9PSBcInVuZGVmaW5lZFwiICkgb3B0ID0ge307XG5cblx0XHR2YXIgbWQgPSB1cmwubWF0Y2gocmVnZXgpIHx8IFtdO1xuXG5cdFx0dmFyIHIgPSB7XG5cdFx0XHRcInVybFwiOiAgICB1cmwsXG5cblx0XHRcdFwic2NoZW1lXCI6IG1kWzFdLFxuXHRcdFx0XCJ1c2VyXCI6ICAgbWRbMl0sXG5cdFx0XHRcInBhc3NcIjogICBtZFszXSxcblx0XHRcdFwiaG9zdFwiOiAgIG1kWzRdLFxuXHRcdFx0XCJwb3J0XCI6ICAgbWRbNV0gJiYgK21kWzVdLFxuXHRcdFx0XCJwYXRoXCI6ICAgbWRbNl0sXG5cdFx0XHRcInF1ZXJ5XCI6ICBtZFs3XSxcblx0XHRcdFwiaGFzaFwiOiAgIG1kWzhdLFxuXHRcdH07XG5cblx0XHRpZiAoIG9wdC5nZXQgIT09IGZhbHNlIClcblx0XHRcdHJbXCJnZXRcIl0gPSByW1wicXVlcnlcIl0gJiYgc2VsZltcImdldFwiXShyW1wicXVlcnlcIl0sIG9wdC5nZXQpO1xuXG5cdFx0cmV0dXJuIHI7XG5cdH0sXG5cblx0LyoqIEJ1aWxkIGEgVVJMIGZyb20gY29tcG9uZW50cy5cblx0ICpcblx0ICogVGhpcyBwaWVjZXMgdG9nZXRoZXIgYSB1cmwgZnJvbSB0aGUgcHJvcGVydGllcyBvZiB0aGUgcGFzc2VkIGluIG9iamVjdC5cblx0ICogSW4gZ2VuZXJhbCBwYXNzaW5nIHRoZSByZXN1bHQgb2YgYHBhcnNlKClgIHNob3VsZCByZXR1cm4gdGhlIFVSTC4gIFRoZXJlXG5cdCAqIG1heSBkaWZmZXJlbmNlcyBpbiB0aGUgZ2V0IHN0cmluZyBhcyB0aGUga2V5cyBhbmQgdmFsdWVzIG1pZ2h0IGJlIG1vcmVcblx0ICogZW5jb2RlZCB0aGVuIHRoZXkgd2VyZSBvcmlnaW5hbGx5IHdlcmUuICBIb3dldmVyLCBjYWxsaW5nIGBnZXQoKWAgb24gdGhlXG5cdCAqIHR3byB2YWx1ZXMgc2hvdWxkIHlpZWxkIHRoZSBzYW1lIHJlc3VsdC5cblx0ICpcblx0ICogSGVyZSBpcyBob3cgdGhlIHBhcmFtZXRlcnMgYXJlIHVzZWQuXG5cdCAqXG5cdCAqICAtIHVybDogVXNlZCBvbmx5IGlmIG5vIG90aGVyIHZhbHVlcyBhcmUgcHJvdmlkZWQuICBJZiB0aGF0IGlzIHRoZSBjYXNlXG5cdCAqICAgICBgdXJsYCB3aWxsIGJlIHJldHVybmVkIHZlcmJhdGltLlxuXHQgKiAgLSBzY2hlbWU6IFVzZWQgaWYgZGVmaW5lZC5cblx0ICogIC0gdXNlcjogVXNlZCBpZiBkZWZpbmVkLlxuXHQgKiAgLSBwYXNzOiBVc2VkIGlmIGRlZmluZWQuXG5cdCAqICAtIGhvc3Q6IFVzZWQgaWYgZGVmaW5lZC5cblx0ICogIC0gcGF0aDogVXNlZCBpZiBkZWZpbmVkLlxuXHQgKiAgLSBxdWVyeTogVXNlZCBvbmx5IGlmIGBnZXRgIGlzIG5vdCBwcm92aWRlZCBhbmQgbm9uLWVtcHR5LlxuXHQgKiAgLSBnZXQ6IFVzZWQgaWYgbm9uLWVtcHR5LiAgUGFzc2VkIHRvICNidWlsZGdldCBhbmQgdGhlIHJlc3VsdCBpcyB1c2VkXG5cdCAqICAgIGFzIHRoZSBxdWVyeSBzdHJpbmcuXG5cdCAqICAtIGhhc2g6IFVzZWQgaWYgZGVmaW5lZC5cblx0ICpcblx0ICogVGhlc2UgYXJlIHRoZSBvcHRpb25zIHRoYXQgYXJlIHZhbGlkIG9uIHRoZSBvcHRpb25zIG9iamVjdC5cblx0ICpcblx0ICogIC0gdXNlZW1wdHlnZXQ6IElmIHRydXRoeSwgYSBxdWVzdGlvbiBtYXJrIHdpbGwgYmUgYXBwZW5kZWQgZm9yIGVtcHR5IGdldFxuXHQgKiAgICBzdHJpbmdzLiAgVGhpcyBub3RhYmx5IG1ha2VzIGBidWlsZCgpYCBhbmQgYHBhcnNlKClgIGZ1bGx5IHN5bW1ldHJpYy5cblx0ICpcblx0ICogQHBhcmFte09iamVjdH0gZGF0YSBUaGUgcGllY2VzIG9mIHRoZSBVUkwuXG5cdCAqIEBwYXJhbXtPYmplY3R9IG9wdCBPcHRpb25zIGZvciBidWlsZGluZyB0aGUgdXJsLlxuXHQgKiBAcmV0dXJue3N0cmluZ30gVGhlIFVSTC5cblx0ICovXG5cdFwiYnVpbGRcIjogZnVuY3Rpb24oZGF0YSwgb3B0KXtcblx0XHRvcHQgPSBvcHQgfHwge307XG5cblx0XHR2YXIgciA9IFwiXCI7XG5cblx0XHRpZiAoIHR5cGVvZiBkYXRhW1wic2NoZW1lXCJdICE9IFwidW5kZWZpbmVkXCIgKVxuXHRcdHtcblx0XHRcdHIgKz0gZGF0YVtcInNjaGVtZVwiXTtcblx0XHRcdHIgKz0gKG5vc2xhc2guaW5kZXhPZihkYXRhW1wic2NoZW1lXCJdKT49MCk/XCI6XCI6XCI6Ly9cIjtcblx0XHR9XG5cdFx0aWYgKCB0eXBlb2YgZGF0YVtcInVzZXJcIl0gIT0gXCJ1bmRlZmluZWRcIiApXG5cdFx0e1xuXHRcdFx0ciArPSBkYXRhW1widXNlclwiXTtcblx0XHRcdGlmICggdHlwZW9mIGRhdGFbXCJwYXNzXCJdID09IFwidW5kZWZpbmVkXCIgKVxuXHRcdFx0e1xuXHRcdFx0XHRyICs9IFwiQFwiO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoIHR5cGVvZiBkYXRhW1wicGFzc1wiXSAhPSBcInVuZGVmaW5lZFwiICkgciArPSBcIjpcIiArIGRhdGFbXCJwYXNzXCJdICsgXCJAXCI7XG5cdFx0aWYgKCB0eXBlb2YgZGF0YVtcImhvc3RcIl0gIT0gXCJ1bmRlZmluZWRcIiApIHIgKz0gZGF0YVtcImhvc3RcIl07XG5cdFx0aWYgKCB0eXBlb2YgZGF0YVtcInBvcnRcIl0gIT0gXCJ1bmRlZmluZWRcIiApIHIgKz0gXCI6XCIgKyBkYXRhW1wicG9ydFwiXTtcblx0XHRpZiAoIHR5cGVvZiBkYXRhW1wicGF0aFwiXSAhPSBcInVuZGVmaW5lZFwiICkgciArPSBkYXRhW1wicGF0aFwiXTtcblxuXHRcdGlmIChvcHRbXCJ1c2VlbXB0eWdldFwiXSlcblx0XHR7XG5cdFx0XHRpZiAgICAgICggdHlwZW9mIGRhdGFbXCJnZXRcIl0gICAhPSBcInVuZGVmaW5lZFwiICkgciArPSBcIj9cIiArIHNlbGZbXCJidWlsZGdldFwiXShkYXRhW1wiZ2V0XCJdKTtcblx0XHRcdGVsc2UgaWYgKCB0eXBlb2YgZGF0YVtcInF1ZXJ5XCJdICE9IFwidW5kZWZpbmVkXCIgKSByICs9IFwiP1wiICsgZGF0YVtcInF1ZXJ5XCJdO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0Ly8gSWYgLmdldCB1c2UgaXQuICBJZiAuZ2V0IGxlYWRzIHRvIGVtcHR5LCB1c2UgLnF1ZXJ5LlxuXHRcdFx0dmFyIHEgPSBkYXRhW1wiZ2V0XCJdICYmIHNlbGZbXCJidWlsZGdldFwiXShkYXRhW1wiZ2V0XCJdKSB8fCBkYXRhW1wicXVlcnlcIl07XG5cdFx0XHRpZiAocSkgciArPSBcIj9cIiArIHE7XG5cdFx0fVxuXG5cdFx0aWYgKCB0eXBlb2YgZGF0YVtcImhhc2hcIl0gIT0gXCJ1bmRlZmluZWRcIiApIHIgKz0gXCIjXCIgKyBkYXRhW1wiaGFzaFwiXTtcblxuXHRcdHJldHVybiByIHx8IGRhdGFbXCJ1cmxcIl0gfHwgXCJcIjtcblx0fSxcbn07XG5cbmlmICggdHlwZW9mIGRlZmluZSAhPSBcInVuZGVmaW5lZFwiICYmIGRlZmluZVtcImFtZFwiXSApIGRlZmluZShzZWxmKTtcbmVsc2UgaWYgKCB0eXBlb2YgbW9kdWxlICE9IFwidW5kZWZpbmVkXCIgKSBtb2R1bGVbJ2V4cG9ydHMnXSA9IHNlbGY7XG5lbHNlIHdpbmRvd1tcInVybFwiXSA9IHNlbGY7XG5cbn0oKTsiLCJjb25zdCBhc2lkZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNhc2lkZScpO1xuY29uc3QgYXNpZGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYXNpZGUtYnRuJyk7XG5mdW5jdGlvbiBoYW5kbGVBc2lkZShldmVudCkge1xuICAgIGFzaWRlLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTtcbn1cbmlmIChhc2lkZUJ0bilcbntcbiAgICBhc2lkZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUFzaWRlKTtcbn1cblxuY29uc3QgcHJvZmlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlJyk7XG5cbmlmIChwcm9maWxlKVxue1xuICAgIGNvbnN0IGRyb3Bkb3duID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGUtZHJvcGRvd24nKTtcblxuICAgIGZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVDbGljayhldmVudCkge1xuICAgICAgICBkcm9wZG93bi5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7XG4gICAgfVxuICAgIHByb2ZpbGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVQcm9maWxlQ2xpY2spO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmICghZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJy5wcm9maWxlLWRpdicpKSB7XG4gICAgICAgICAgICBkcm9wZG93bi5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFldmVudC50YXJnZXQuY2xvc2VzdCgnI2FzaWRlJykgJiYgIWV2ZW50LnRhcmdldC5jbG9zZXN0KCcjYXNpZGUtYnRuJykpIHtcbiAgICAgICAgICAgIGFzaWRlLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5cbmFtNGNvcmUucmVhZHkoZnVuY3Rpb24gKCkge1xuXG4gICAgLy8gVGhlbWVzIGJlZ2luXG4gICAgYW00Y29yZS51c2VUaGVtZShhbTR0aGVtZXNfYW1jaGFydHMpO1xuICAgIC8vIFRoZW1lcyBlbmRcblxuICAgIC8vIENyZWF0ZSBjaGFydCBpbnN0YW5jZVxuICAgIHZhciBjaGFydCA9IGFtNGNvcmUuY3JlYXRlKFwiY2hhcnRkaXZcIiwgYW00Y2hhcnRzLlhZQ2hhcnQpO1xuXG4gICAgY2hhcnQucnRsID0gdHJ1ZTtcblxuICAgIC8vIEFkZCBkYXRhXG4gICAgY2hhcnQuZGF0YSA9IFt7XG4gICAgICAgIFwiY291bnRyeVwiOiBcIlVTQVwiLFxuICAgICAgICBcInZpc2l0c1wiOiAyMDI1XG4gICAgfSwge1xuICAgICAgICBcImNvdW50cnlcIjogXCJDaGluYVwiLFxuICAgICAgICBcInZpc2l0c1wiOiAxODgyXG4gICAgfSwge1xuICAgICAgICBcImNvdW50cnlcIjogXCJKYXBhblwiLFxuICAgICAgICBcInZpc2l0c1wiOiAxODA5XG4gICAgfSwge1xuICAgICAgICBcImNvdW50cnlcIjogXCJHZXJtYW55XCIsXG4gICAgICAgIFwidmlzaXRzXCI6IDEzMjJcbiAgICB9LCB7XG4gICAgICAgIFwiY291bnRyeVwiOiBcIlVLXCIsXG4gICAgICAgIFwidmlzaXRzXCI6IDExMjJcbiAgICB9LCB7XG4gICAgICAgIFwiY291bnRyeVwiOiBcIkZyYW5jZVwiLFxuICAgICAgICBcInZpc2l0c1wiOiAxMTE0XG4gICAgfSwge1xuICAgICAgICBcImNvdW50cnlcIjogXCJJbmRpYVwiLFxuICAgICAgICBcInZpc2l0c1wiOiA5ODRcbiAgICB9LCB7XG4gICAgICAgIFwiY291bnRyeVwiOiBcIlNwYWluXCIsXG4gICAgICAgIFwidmlzaXRzXCI6IDcxMVxuICAgIH0sIHtcbiAgICAgICAgXCJjb3VudHJ5XCI6IFwiTmV0aGVybGFuZHNcIixcbiAgICAgICAgXCJ2aXNpdHNcIjogNjY1XG4gICAgfSwge1xuICAgICAgICBcImNvdW50cnlcIjogXCJSdXNzaWFcIixcbiAgICAgICAgXCJ2aXNpdHNcIjogNTgwXG4gICAgfSwge1xuICAgICAgICBcImNvdW50cnlcIjogXCJTb3V0aCBLb3JlYVwiLFxuICAgICAgICBcInZpc2l0c1wiOiA0NDNcbiAgICB9LCB7XG4gICAgICAgIFwiY291bnRyeVwiOiBcIkNhbmFkYVwiLFxuICAgICAgICBcInZpc2l0c1wiOiA0NDFcbiAgICB9LCB7XG4gICAgICAgIFwiY291bnRyeVwiOiBcIkJyYXppbFwiLFxuICAgICAgICBcInZpc2l0c1wiOiAzOTVcbiAgICB9XTtcblxuICAgIC8vIENyZWF0ZSBheGVzXG5cbiAgICB2YXIgY2F0ZWdvcnlBeGlzID0gY2hhcnQueEF4ZXMucHVzaChuZXcgYW00Y2hhcnRzLkNhdGVnb3J5QXhpcygpKTtcbiAgICBjYXRlZ29yeUF4aXMuZGF0YUZpZWxkcy5jYXRlZ29yeSA9IFwiY291bnRyeVwiO1xuICAgIGNhdGVnb3J5QXhpcy5yZW5kZXJlci5ncmlkLnRlbXBsYXRlLmxvY2F0aW9uID0gMDtcbiAgICBjYXRlZ29yeUF4aXMucmVuZGVyZXIubWluR3JpZERpc3RhbmNlID0gMzA7XG5cbiAgICBjYXRlZ29yeUF4aXMucmVuZGVyZXIubGFiZWxzLnRlbXBsYXRlLmFkYXB0ZXIuYWRkKFwiZHlcIiwgZnVuY3Rpb24gKGR5LCB0YXJnZXQpIHtcbiAgICAgICAgaWYgKHRhcmdldC5kYXRhSXRlbSAmJiB0YXJnZXQuZGF0YUl0ZW0uaW5kZXggJiAyID09IDIpIHtcbiAgICAgICAgICAgIHJldHVybiBkeSArIDI1O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkeTtcbiAgICB9KTtcblxuICAgIHZhciB2YWx1ZUF4aXMgPSBjaGFydC55QXhlcy5wdXNoKG5ldyBhbTRjaGFydHMuVmFsdWVBeGlzKCkpO1xuXG4gICAgLy8gQ3JlYXRlIHNlcmllc1xuICAgIHZhciBzZXJpZXMgPSBjaGFydC5zZXJpZXMucHVzaChuZXcgYW00Y2hhcnRzLkNvbHVtblNlcmllcygpKTtcbiAgICBzZXJpZXMuZGF0YUZpZWxkcy52YWx1ZVkgPSBcInZpc2l0c1wiO1xuICAgIHNlcmllcy5kYXRhRmllbGRzLmNhdGVnb3J5WCA9IFwiY291bnRyeVwiO1xuICAgIHNlcmllcy5uYW1lID0gXCJWaXNpdHNcIjtcbiAgICBzZXJpZXMuY29sdW1ucy50ZW1wbGF0ZS50b29sdGlwVGV4dCA9IFwie2NhdGVnb3J5WH06IFtib2xkXXt2YWx1ZVl9Wy9dXCI7XG4gICAgc2VyaWVzLmNvbHVtbnMudGVtcGxhdGUuZmlsbE9wYWNpdHkgPSAuODtcblxuICAgIHZhciBjb2x1bW5UZW1wbGF0ZSA9IHNlcmllcy5jb2x1bW5zLnRlbXBsYXRlO1xuICAgIGNvbHVtblRlbXBsYXRlLnN0cm9rZVdpZHRoID0gMjtcbiAgICBjb2x1bW5UZW1wbGF0ZS5zdHJva2VPcGFjaXR5ID0gMTtcblxufSk7IC8vIGVuZCBhbTRjb3JlLnJlYWR5KClcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgJCgnLnNlbGVjdDInKS5zZWxlY3QyKCk7XG59KTtcblxuZnVuY3Rpb24gcmVhZFVSTChpbnB1dCkge1xuICAgIGlmIChpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlc1swXSkge1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgJChpbnB1dCkubmV4dCgnbGFiZWwnKS5jaGlsZHJlbignaW1nJykuYXR0cignc3JjJywgZS50YXJnZXQucmVzdWx0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGlucHV0LmZpbGVzWzBdKTtcbiAgICB9XG4gIH1cblxuJCgnLmlucHV0LWF2YXRhcicpLmNoYW5nZShmdW5jdGlvbigpIHtcbiAgICByZWFkVVJMKHRoaXMpO1xufSk7IiwiXG52YXIgZGF0ZXBpY2tlciA9IGZ1bmN0aW9uIChlbGVtZW50SUQsIG9wdCkge1xuXG4gICAgLy8gY2hlY2sgYXJndW1lbnRzXG4gICAgaWYgKHR5cGVvZiBlbGVtZW50SUQgIT09IFwic3RyaW5nXCIgfHwgZWxlbWVudElELmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiZGF0ZXBpY2tlciBlcnJvcjogaW5wdXQgSUQgaXMgbm90IHN0cmluZyBvciBpcyBlbXB0eVwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgb3B0aW9ucyA9IG9wdCB8fCB7fTtcblxuICAgIC8vIHZhcmlhYmxlc1xuICAgIHZhciBpc0NhbENsaWNrZWQgPSBmYWxzZTtcbiAgICB2YXIgaXNTeW5jZWQgPSBmYWxzZTtcblxuICAgIHZhciBkYXlPZldlZWs7XG5cbiAgICB2YXIgc2VsZWN0ZWRZZWFyO1xuICAgIHZhciBzZWxlY3RlZE1vbnRoO1xuICAgIHZhciBzZWxlY3RlZERheTtcblxuICAgIHZhciBjdXJyZW50WWVhcjtcbiAgICB2YXIgY3VycmVudE1vbnRoO1xuICAgIHZhciBjdXJyZW50RGF5O1xuXG4gICAgdmFyIHRvZGF5c1llYXI7XG4gICAgdmFyIHRvZGF5c01vbnRoO1xuICAgIHZhciB0b2RheXNEYXk7XG5cbiAgICB2YXIgZGF5T2ZXZWVrSjtcblxuICAgIHZhciBudW1iZXJPZkRheXM7XG5cbiAgICB2YXIgdG9kYXlHO1xuICAgIHZhciB0b2RheXNKO1xuXG4gICAgLy8gY29uc3RzXG4gICAgdmFyIE1PTlRIX05BTUVTID0ge1xuICAgICAgICBcIjFcIjogXCLZgdix2YjYsdiv24zZhlwiXG4gICAgICAgICwgXCIyXCI6IFwi2KfYsdiv24zYqNmH2LTYqlwiXG4gICAgICAgICwgXCIzXCI6IFwi2K7Ysdiv2KfYr1wiXG4gICAgICAgICwgXCI0XCI6IFwi2KrbjNixXCJcbiAgICAgICAgLCBcIjVcIjogXCLZhdix2K/Yp9ivXCJcbiAgICAgICAgLCBcIjZcIjogXCLYtNmH2LHbjNmI2LFcIlxuICAgICAgICAsIFwiN1wiOiBcItmF2YfYsVwiXG4gICAgICAgICwgXCI4XCI6IFwi2KLYqNin2YZcIlxuICAgICAgICAsIFwiOVwiOiBcItii2LDYsVwiXG4gICAgICAgICwgXCIxMFwiOiBcItiv24xcIlxuICAgICAgICAsIFwiMTFcIjogXCLYqNmH2YXZhlwiXG4gICAgICAgICwgXCIxMlwiOiBcItin2LPZgdmG2K9cIlxuICAgIH1cbiAgICB2YXIgREFZX05BTUVTID0ge1xuICAgICAgICBcIti02YbYqNmHXCI6IFwi2LRcIlxuICAgICAgICAsIFwi24zaqdi02YbYqNmHXCI6IFwi24xcIlxuICAgICAgICAsIFwi2K/ZiNi02YbYqNmHXCI6IFwi2K9cIlxuICAgICAgICAsIFwi2LPZhyDYtNmG2KjZh1wiOiBcItizXCJcbiAgICAgICAgLCBcItqG2YfYp9ix2LTZhtio2YdcIjogXCLahlwiXG4gICAgICAgICwgXCLZvtmG2Kwg2LTZhtio2YdcIjogXCLZvlwiXG4gICAgICAgICwgXCLYrNmF2LnZh1wiOiBcItisXCJcbiAgICB9O1xuICAgIHZhciBGQV9OVU1TID0gWyfZoCcsICfZoScsICfZoicsICfZoycsICfbtCcsICfbtScsICfbticsICfZpycsICfZqCcsICfZqScsICfZodmgJywgJ9mh2aEnLCAn2aHZoicsICfZodmjJywgJ9mh27QnLCAn2aHbtScsICfZodu2JywgJ9mh2acnLCAn2aHZqCcsICfZodmpJywgJ9mi2aAnLCAn2aLZoScsICfZotmiJywgJ9mi2aMnLCAn2aLbtCcsICfZotu1JywgJ9mi27YnLCAn2aLZpycsICfZotmoJywgJ9mi2aknLCAn2aPZoCcsICfZo9mhJywgJ9mj2aInXTtcblxuICAgIC8vIHNldCBvcHRpb25zXG4gICAgb3B0aW9ucy5wbGFjZWhvbGRlciA9IG9wdGlvbnMucGxhY2Vob2xkZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucGxhY2Vob2xkZXIgOiBcIlwiO1xuICAgIG9wdGlvbnMudHdvZGlnaXQgPSBvcHRpb25zLnR3b2RpZ2l0ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnR3b2RpZ2l0IDogdHJ1ZTtcbiAgICBvcHRpb25zLmNsb3NlQWZ0ZXJTZWxlY3QgPSBvcHRpb25zLmNsb3NlQWZ0ZXJTZWxlY3QgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuY2xvc2VBZnRlclNlbGVjdCA6IHRydWU7XG4gICAgb3B0aW9ucy5uZXh0QnV0dG9uSWNvbiA9IG9wdGlvbnMubmV4dEJ1dHRvbkljb24gIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMubmV4dEJ1dHRvbkljb24gOiBmYWxzZTtcbiAgICBvcHRpb25zLnByZXZpb3VzQnV0dG9uSWNvbiA9IG9wdGlvbnMucHJldmlvdXNCdXR0b25JY29uICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnByZXZpb3VzQnV0dG9uSWNvbiA6IGZhbHNlO1xuICAgIG9wdGlvbnMuYnV0dG9uc0NvbG9yID0gb3B0aW9ucy5idXR0b25zQ29sb3IgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYnV0dG9uc0NvbG9yIDogZmFsc2U7XG4gICAgb3B0aW9ucy5mb3JjZUZhcnNpRGlnaXRzID0gb3B0aW9ucy5mb3JjZUZhcnNpRGlnaXRzICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmZvcmNlRmFyc2lEaWdpdHMgOiBmYWxzZTtcbiAgICBvcHRpb25zLm1hcmtUb2RheSA9IG9wdGlvbnMubWFya1RvZGF5ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLm1hcmtUb2RheSA6IGZhbHNlO1xuICAgIG9wdGlvbnMubWFya0hvbGlkYXlzID0gb3B0aW9ucy5tYXJrSG9saWRheXMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMubWFya0hvbGlkYXlzIDogZmFsc2U7XG4gICAgb3B0aW9ucy5oaWdobGlnaHRTZWxlY3RlZERheSA9IG9wdGlvbnMuaGlnaGxpZ2h0U2VsZWN0ZWREYXkgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuaGlnaGxpZ2h0U2VsZWN0ZWREYXkgOiBmYWxzZTtcbiAgICBvcHRpb25zLnN5bmMgPSBvcHRpb25zLnN5bmMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc3luYyA6IGZhbHNlO1xuICAgIG9wdGlvbnMuZ290b1RvZGF5ID0gb3B0aW9ucy5nb3RvVG9kYXkgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuZ290b1RvZGF5IDogZmFsc2U7XG5cbiAgICAvLyBjcmVhdGUgRE9NXG4gICAgdmFyIGlucHV0RWxlbWVudCA9ICQoXCIjXCIgKyBlbGVtZW50SUQpO1xuXG4gICAgaWYgKGlucHV0RWxlbWVudC5hdHRyKFwicGxhY2Vob2xkZXJcIikgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpbnB1dEVsZW1lbnQuYXR0cihcInBsYWNlaG9sZGVyXCIsIG9wdGlvbnMucGxhY2Vob2xkZXIpO1xuICAgIH1cblxuICAgIC8vIGNyZWF0ZSBwYXJlbnQgZGl2XG4gICAgaW5wdXRFbGVtZW50LndyYXAoXCI8ZGl2IGlkPSdiZC1yb290LVwiICsgZWxlbWVudElEICsgXCInIHN0eWxlPSdwb3NpdGlvbjogcmVsYXRpdmU7Jz48L2Rpdj5cIik7XG5cbiAgICAvLyBjcmVhdGUgbWFpbiBkaXYgZm9yIGNhbGVuZGFyLCBiZWxvdyBpbnB1dCBlbGVtZW50XG4gICAgaW5wdXRFbGVtZW50LmFmdGVyKFwiPGRpdiBpZD0nYmQtbWFpbi1cIiArIGVsZW1lbnRJRCArIFwiJyBjbGFzcz0nYmQtbWFpbiBiZC1oaWRlJyBzdHlsZT0ncG9zaXRpb246IGFic29sdXRlOyBkaXJlY3Rpb246IHJ0bDsnPjwvZGl2PlwiKTtcbiAgICB2YXIgbWFpbkRpdiA9ICQoXCIjYmQtbWFpbi1cIiArIGVsZW1lbnRJRCk7XG5cbiAgICAvLyBjcmVhdGUgY2FsZW5kYXIgZGl2IGluc2lkZSBtYWluIGRpdlxuICAgIG1haW5EaXYuYXBwZW5kKFwiPGRpdiBjbGFzcz0nYmQtY2FsZW5kYXInPjwvZGl2PlwiKTtcbiAgICB2YXIgY2FsZW5kYXJEaXYgPSBtYWluRGl2LmZpbmQoJy5iZC1jYWxlbmRhcicpO1xuXG4gICAgLy8gY3JlYXRlIHRpdGxlIGRpdiBhbmQgdGFibGUgaW5zaWRlIGNhbGVuZGFyIGRpdlxuICAgIGNhbGVuZGFyRGl2LmFwcGVuZChcIjxkaXYgY2xhc3M9J2JkLXRpdGxlJz48L2Rpdj5cIik7XG4gICAgdmFyIHRpdGxlRGl2ID0gY2FsZW5kYXJEaXYuZmluZCgnLmJkLXRpdGxlJyk7XG4gICAgY2FsZW5kYXJEaXYuYXBwZW5kKFwiPHRhYmxlIGNsYXNzPSdiZC10YWJsZScgZGlyPSdydGwnIGNlbGxzcGFjaW5nPScwJyBjZWxscGFkZGluZz0nMCc+PC90YWJsZT5cIik7XG5cbiAgICAvLyBjcmVhdGUgbW9udGggYW5kIHllYXIgZHJvcCBkb3ducyBhbmQgbmV4dC9wcmV2IG1vbnRoIGJ1dHRvbnMgaW5zaWRlIHRpdGxlIGRpdlxuICAgIHRpdGxlRGl2LmFwcGVuZChcIjxidXR0b24gaWQ9J2JkLW5leHQtXCIgKyBlbGVtZW50SUQgKyBcIicgY2xhc3M9J2JkLW5leHQnIHR5cGU9J2J1dHRvbicgdGl0bGU9J9mF2KfZhyDYqNi52K/bjCcgZGF0YS10b2dnbGU9J3Rvb2x0aXAnPjxzcGFuPtio2LnYr9uMPC9zcGFuPjwvYnV0dG9uPlwiKTtcbiAgICB2YXIgbmV4dE1vbnRoID0gJChcIiNiZC1uZXh0LVwiICsgZWxlbWVudElEKTtcbiAgICBpZiAob3B0aW9ucy5uZXh0QnV0dG9uSWNvbikge1xuICAgICAgICBuZXh0TW9udGguZmluZChcInNwYW5cIikuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgICAgIGlmIChvcHRpb25zLm5leHRCdXR0b25JY29uLmluZGV4T2YoXCIuXCIpICE9PSAtMSkge1xuICAgICAgICAgICAgLy8gaW1hZ2VcbiAgICAgICAgICAgIG5leHRNb250aC5jc3MoXCJiYWNrZ3JvdW5kLWltYWdlXCIsIFwidXJsKFwiICsgb3B0aW9ucy5uZXh0QnV0dG9uSWNvbiArIFwiKVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGNzcyBjbGFzc1xuICAgICAgICAgICAgbmV4dE1vbnRoLmFkZENsYXNzKG9wdGlvbnMubmV4dEJ1dHRvbkljb24pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdGl0bGVEaXYuYXBwZW5kKFwiPGRpdiBjbGFzcz0nYmQtZHJvcGRvd24nPjwvZGl2PjxkaXYgY2xhc3M9J2JkLWRyb3Bkb3duJz48L2Rpdj5cIik7XG5cbiAgICB0aXRsZURpdi5maW5kKCcuYmQtZHJvcGRvd246bnRoLWNoaWxkKDIpJykuYXBwZW5kKFwiPHNlbGVjdCBpZD0nYmQtbW9udGgtXCIgKyBlbGVtZW50SUQgKyBcIicgY2xhc3M9J2JkLW1vbnRoJz48L3NlbGVjdD5cIik7XG4gICAgdmFyIG1vbnRoRHJvcGRvd24gPSAkKFwiI2JkLW1vbnRoLVwiICsgZWxlbWVudElEKTtcbiAgICAkLmVhY2goTU9OVEhfTkFNRVMsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgIG1vbnRoRHJvcGRvd24uYXBwZW5kKCQoXCI8b3B0aW9uPjwvb3B0aW9uPlwiKS5hdHRyKFwidmFsdWVcIiwga2V5KS50ZXh0KHZhbHVlKSk7XG4gICAgfSk7XG5cbiAgICB0aXRsZURpdi5maW5kKCcuYmQtZHJvcGRvd246bnRoLWNoaWxkKDMpJykuYXBwZW5kKFwiPHNlbGVjdCBpZD0nYmQteWVhci1cIiArIGVsZW1lbnRJRCArIFwiJyBjbGFzcz0nYmQteWVhcic+PC9zZWxlY3Q+XCIpO1xuICAgIHZhciB5ZWFyRHJvcGRvd24gPSAkKFwiI2JkLXllYXItXCIgKyBlbGVtZW50SUQpO1xuXG4gICAgdGl0bGVEaXYuYXBwZW5kKFwiPGJ1dHRvbiBpZD0nYmQtcHJldi1cIiArIGVsZW1lbnRJRCArIFwiJyBjbGFzcz0nYmQtcHJldicgdHlwZT0nYnV0dG9uJyB0aXRsZT0n2YXYp9mHINmC2KjZhNuMJyBkYXRhLXRvZ2dsZT0ndG9vbHRpcCc+PHNwYW4+2YLYqNmE24w8L3NwYW4+PC9idXR0b24+XCIpO1xuICAgIHZhciBwcmV2TW9udGggPSAkKFwiI2JkLXByZXYtXCIgKyBlbGVtZW50SUQpO1xuICAgIGlmIChvcHRpb25zLm5leHRCdXR0b25JY29uKSB7XG4gICAgICAgIHByZXZNb250aC5maW5kKFwic3BhblwiKS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICAgICAgaWYgKG9wdGlvbnMucHJldmlvdXNCdXR0b25JY29uLmluZGV4T2YoXCIuXCIpICE9PSAtMSkge1xuICAgICAgICAgICAgLy8gaW1hZ2VcbiAgICAgICAgICAgIHByZXZNb250aC5jc3MoXCJiYWNrZ3JvdW5kLWltYWdlXCIsIFwidXJsKFwiICsgb3B0aW9ucy5wcmV2aW91c0J1dHRvbkljb24gKyBcIilcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBjc3MgY2xhc3NcbiAgICAgICAgICAgIHByZXZNb250aC5hZGRDbGFzcyhvcHRpb25zLnByZXZpb3VzQnV0dG9uSWNvbik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5idXR0b25zQ29sb3IpIHtcbiAgICAgICAgbmV4dE1vbnRoLmNzcyhcImNvbG9yXCIsIG9wdGlvbnMuYnV0dG9uc0NvbG9yKTtcbiAgICAgICAgbmV4dE1vbnRoLmZpbmQoXCJzcGFuXCIpLmNzcyhcImNvbG9yXCIsIG9wdGlvbnMuYnV0dG9uc0NvbG9yKTtcbiAgICAgICAgcHJldk1vbnRoLmNzcyhcImNvbG9yXCIsIG9wdGlvbnMuYnV0dG9uc0NvbG9yKTtcbiAgICAgICAgcHJldk1vbnRoLmZpbmQoXCJzcGFuXCIpLmNzcyhcImNvbG9yXCIsIG9wdGlvbnMuYnV0dG9uc0NvbG9yKTtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgdGFibGUgaGVhZGVyIGFuZCBib2R5XG4gICAgY2FsZW5kYXJEaXYuZmluZCgnLmJkLXRhYmxlJykuYXBwZW5kKFwiPHRoZWFkPjx0cj48L3RyPjwvdGhlYWQ+XCIpO1xuICAgICQuZWFjaChEQVlfTkFNRVMsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgIGNhbGVuZGFyRGl2LmZpbmQoJy5iZC10YWJsZSB0aGVhZCB0cicpLmFwcGVuZCgkKFwiPHRoPjwvdGg+XCIpLnRleHQodmFsdWUpKTtcbiAgICB9KTtcblxuICAgIGNhbGVuZGFyRGl2LmZpbmQoJy5iZC10YWJsZScpLmFwcGVuZChcIjx0Ym9keSBpZD0nYmQtdGFibGUtZGF5cy1cIiArIGVsZW1lbnRJRCArIFwiJyBjbGFzcz0nYmQtdGFibGUtZGF5cyc+PC90Ym9keT5cIik7XG4gICAgdmFyIGRheXNUYWJsZSA9ICQoXCIjYmQtdGFibGUtZGF5cy1cIiArIGVsZW1lbnRJRCk7XG5cbiAgICAvLyBjcmVhdGUgZ28gdG8gdG9kYXlzIGJ1dHRvblxuICAgIGlmIChvcHRpb25zLmdvdG9Ub2RheSkge1xuICAgICAgICBjYWxlbmRhckRpdi5hcHBlbmQoXCI8ZGl2IGNsYXNzPSdiZC1nb3RvLXRvZGF5Jz7YqNix2Ygg2KjZhyDYp9mF2LHZiNiyPC9kaXY+XCIpO1xuICAgICAgICB2YXIgZ290b1RvZGF5ID0gY2FsZW5kYXJEaXYuZmluZChcIi5iZC1nb3RvLXRvZGF5XCIpO1xuICAgIH1cblxuICAgIC8vIG9wZW5pbmcgYW5kIGNsb3NpbmcgZnVuY3Rpb25hbGl0eVxuICAgIGlucHV0RWxlbWVudC5vbihcImZvY3VzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbWFpbkRpdi5yZW1vdmVDbGFzcyhcImJkLWhpZGVcIik7XG4gICAgICAgIGlmIChvcHRpb25zLnN5bmMgJiYgaXNTeW5jZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBzeW5jQ2FsZW5kYXIoKTtcbiAgICAgICAgICAgIGlzU3luY2VkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBtYWluRGl2O1xuICAgIH0pLm9uKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoaXNDYWxDbGlja2VkID09IGZhbHNlKSB7XG4gICAgICAgICAgICBtYWluRGl2LmFkZENsYXNzKFwiYmQtaGlkZVwiKTtcbiAgICAgICAgICAgIGlzU3luY2VkID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpc0NhbENsaWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGlucHV0RWxlbWVudC5mb2N1cygpO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWFpbkRpdi5vbignbW91c2Vkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlzQ2FsQ2xpY2tlZCA9IHRydWU7XG4gICAgfSk7XG5cbiAgICAvLyBkcm9wZG93biBldmVudHNcbiAgICBtb250aERyb3Bkb3duLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGVjdGVkTW9udGggPSBwYXJzZUludCh0aGlzLnZhbHVlKTtcbiAgICAgICAgbnVtYmVyT2ZEYXlzID0gbW9udGhEYXlzKHNlbGVjdGVkWWVhciwgc2VsZWN0ZWRNb250aCk7XG4gICAgICAgIGRheU9mV2Vla0ogPSBmaW5kRmlyc3REYXlPZk1vbnRoKHNlbGVjdGVkWWVhciwgc2VsZWN0ZWRNb250aCk7XG4gICAgICAgIGRyYXdEYXlzKG51bWJlck9mRGF5cywgZGF5T2ZXZWVrSik7XG4gICAgfSk7XG4gICAgeWVhckRyb3Bkb3duLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGVjdGVkWWVhciA9IHBhcnNlSW50KHRoaXMudmFsdWUpO1xuICAgICAgICBudW1iZXJPZkRheXMgPSBtb250aERheXMoc2VsZWN0ZWRZZWFyLCBzZWxlY3RlZE1vbnRoKTtcbiAgICAgICAgZGF5T2ZXZWVrSiA9IGZpbmRGaXJzdERheU9mTW9udGgoc2VsZWN0ZWRZZWFyLCBzZWxlY3RlZE1vbnRoKTtcbiAgICAgICAgZHJhd0RheXMobnVtYmVyT2ZEYXlzLCBkYXlPZldlZWtKKTtcbiAgICB9KTtcblxuICAgIC8vIEdlb3JnaWFuIHRvIEphbGFsaSBjb252ZXJ0ZXIgKG1pbmlmaWVkKVxuICAgIC8vIHNvdXJjZSBpcyB1bmtub3duLiBjb250YWN0IGlmIHlvdSBrbm93IHRoZSBjb2RlIG93bmVyLlxuICAgIGZ1bmN0aW9uIGdyZWdvcmlhblRvSmFsYWxpKGEsIHIsIHMpIHsgYSA9IHBhcnNlSW50KGEpLCByID0gcGFyc2VJbnQociksIHMgPSBwYXJzZUludChzKTsgZm9yICh2YXIgbiA9IGEgLSAxNjAwLCBlID0gciAtIDEsIHQgPSBzIC0gMSwgcCA9IDM2NSAqIG4gKyBwYXJzZUludCgobiArIDMpIC8gNCkgLSBwYXJzZUludCgobiArIDk5KSAvIDEwMCkgKyBwYXJzZUludCgobiArIDM5OSkgLyA0MDApLCBJID0gMDsgZSA+IEk7ICsrSSkgcCArPSBnX2RheXNbSV07IGUgPiAxICYmIChuICUgNCA9PSAwICYmIG4gJSAxMDAgIT0gMCB8fCBuICUgNDAwID09IDApICYmICsrcCwgcCArPSB0OyB2YXIgdiA9IHAgLSA3OSwgZCA9IHBhcnNlSW50KHYgLyAxMjA1Myk7IHYgJT0gMTIwNTM7IHZhciBvID0gOTc5ICsgMzMgKiBkICsgNCAqIHBhcnNlSW50KHYgLyAxNDYxKTsgdiAlPSAxNDYxLCB2ID49IDM2NiAmJiAobyArPSBwYXJzZUludCgodiAtIDEpIC8gMzY1KSwgdiA9ICh2IC0gMSkgJSAzNjUpOyBmb3IgKHZhciBJID0gMDsgMTEgPiBJICYmIHYgPj0gal9kYXlzW0ldOyArK0kpIHYgLT0gal9kYXlzW0ldOyB2YXIgeSA9IEkgKyAxLCBfID0gdiArIDE7IHJldHVybiBbbywgeSwgX10gfSB2YXIgZ19kYXlzID0gWzMxLCAyOCwgMzEsIDMwLCAzMSwgMzAsIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzFdLCBqX2RheXMgPSBbMzEsIDMxLCAzMSwgMzEsIDMxLCAzMSwgMzAsIDMwLCAzMCwgMzAsIDMwLCAyOV07XG4gICAgLy8gSmFsYWxpIHRvIEdlb3JnaWFuIGNvbnZlcnRlciAobWluaWZpZWQpXG4gICAgLy8gc291cmNlIGlzIHVua25vd24uIGNvbnRhY3QgaWYgeW91IGtub3cgdGhlIGNvZGUgb3duZXIuXG4gICAgZnVuY3Rpb24gdG9KYWxhYWxpKGQsIGksIGEpIHsgcmV0dXJuIGQyaihnMmQoZCwgaSwgYSkpIH0gZnVuY3Rpb24gdG9HcmVnb3JpYW4oZCwgaSwgYSkgeyByZXR1cm4gZDJnKGoyZChkLCBpLCBhKSkgfSBmdW5jdGlvbiBpc1ZhbGlkSmFsYWFsaURhdGUoZCwgaSwgYSkgeyByZXR1cm4gZCA+PSAtNjEgJiYgMzE3NyA+PSBkICYmIGkgPj0gMSAmJiAxMiA+PSBpICYmIGEgPj0gMSAmJiBhIDw9IGphbGFhbGlNb250aExlbmd0aChkLCBpKSB9IGZ1bmN0aW9uIGlzTGVhcEphbGFhbGlZZWFyKGQpIHsgcmV0dXJuIDAgPT09IGphbENhbChkKS5sZWFwIH0gZnVuY3Rpb24gamFsYWFsaU1vbnRoTGVuZ3RoKGQsIGkpIHsgcmV0dXJuIDYgPj0gaSA/IDMxIDogMTEgPj0gaSA/IDMwIDogaXNMZWFwSmFsYWFsaVllYXIoZCkgPyAzMCA6IDI5IH0gZnVuY3Rpb24gamFsQ2FsKGQpIHsgdmFyIGksIGEsIG4sIHIsIHQsIG8sIHYsIGUgPSBbLTYxLCA5LCAzOCwgMTk5LCA0MjYsIDY4NiwgNzU2LCA4MTgsIDExMTEsIDExODEsIDEyMTAsIDE2MzUsIDIwNjAsIDIwOTcsIDIxOTIsIDIyNjIsIDIzMjQsIDIzOTQsIDI0NTYsIDMxNzhdLCBsID0gZS5sZW5ndGgsIHUgPSBkICsgNjIxLCBtID0gLTE0LCBnID0gZVswXTsgaWYgKGcgPiBkIHx8IGQgPj0gZVtsIC0gMV0pIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgSmFsYWFsaSB5ZWFyIFwiICsgZCk7IGZvciAodiA9IDE7IGwgPiB2ICYmIChpID0gZVt2XSwgYSA9IGkgLSBnLCAhKGkgPiBkKSk7IHYgKz0gMSkgbSA9IG0gKyA4ICogZGl2KGEsIDMzKSArIGRpdihtb2QoYSwgMzMpLCA0KSwgZyA9IGk7IHJldHVybiBvID0gZCAtIGcsIG0gPSBtICsgOCAqIGRpdihvLCAzMykgKyBkaXYobW9kKG8sIDMzKSArIDMsIDQpLCA0ID09PSBtb2QoYSwgMzMpICYmIGEgLSBvID09PSA0ICYmIChtICs9IDEpLCByID0gZGl2KHUsIDQpIC0gZGl2KDMgKiAoZGl2KHUsIDEwMCkgKyAxKSwgNCkgLSAxNTAsIHQgPSAyMCArIG0gLSByLCA2ID4gYSAtIG8gJiYgKG8gPSBvIC0gYSArIDMzICogZGl2KGEgKyA0LCAzMykpLCBuID0gbW9kKG1vZChvICsgMSwgMzMpIC0gMSwgNCksIC0xID09PSBuICYmIChuID0gNCksIHsgbGVhcDogbiwgZ3k6IHUsIG1hcmNoOiB0IH0gfSBmdW5jdGlvbiBqMmQoZCwgaSwgYSkgeyB2YXIgbiA9IGphbENhbChkKTsgcmV0dXJuIGcyZChuLmd5LCAzLCBuLm1hcmNoKSArIDMxICogKGkgLSAxKSAtIGRpdihpLCA3KSAqIChpIC0gNykgKyBhIC0gMSB9IGZ1bmN0aW9uIGQyaihkKSB7IHZhciBpLCBhLCBuLCByID0gZDJnKGQpLmd5LCB0ID0gciAtIDYyMSwgbyA9IGphbENhbCh0KSwgdiA9IGcyZChyLCAzLCBvLm1hcmNoKTsgaWYgKG4gPSBkIC0gdiwgbiA+PSAwKSB7IGlmICgxODUgPj0gbikgcmV0dXJuIGEgPSAxICsgZGl2KG4sIDMxKSwgaSA9IG1vZChuLCAzMSkgKyAxLCB7IGp5OiB0LCBqbTogYSwgamQ6IGkgfTsgbiAtPSAxODYgfSBlbHNlIHQgLT0gMSwgbiArPSAxNzksIDEgPT09IG8ubGVhcCAmJiAobiArPSAxKTsgcmV0dXJuIGEgPSA3ICsgZGl2KG4sIDMwKSwgaSA9IG1vZChuLCAzMCkgKyAxLCB7IGp5OiB0LCBqbTogYSwgamQ6IGkgfSB9IGZ1bmN0aW9uIGcyZChkLCBpLCBhKSB7IHZhciBuID0gZGl2KDE0NjEgKiAoZCArIGRpdihpIC0gOCwgNikgKyAxMDAxMDApLCA0KSArIGRpdigxNTMgKiBtb2QoaSArIDksIDEyKSArIDIsIDUpICsgYSAtIDM0ODQwNDA4OyByZXR1cm4gbiA9IG4gLSBkaXYoMyAqIGRpdihkICsgMTAwMTAwICsgZGl2KGkgLSA4LCA2KSwgMTAwKSwgNCkgKyA3NTIgfSBmdW5jdGlvbiBkMmcoZCkgeyB2YXIgaSwgYSwgbiwgciwgdDsgcmV0dXJuIGkgPSA0ICogZCArIDEzOTM2MTYzMSwgaSA9IGkgKyA0ICogZGl2KDMgKiBkaXYoNCAqIGQgKyAxODMxODc3MjAsIDE0NjA5NyksIDQpIC0gMzkwOCwgYSA9IDUgKiBkaXYobW9kKGksIDE0NjEpLCA0KSArIDMwOCwgbiA9IGRpdihtb2QoYSwgMTUzKSwgNSkgKyAxLCByID0gbW9kKGRpdihhLCAxNTMpLCAxMikgKyAxLCB0ID0gZGl2KGksIDE0NjEpIC0gMTAwMTAwICsgZGl2KDggLSByLCA2KSwgeyBneTogdCwgZ206IHIsIGdkOiBuIH0gfSBmdW5jdGlvbiBkaXYoZCwgaSkgeyByZXR1cm4gfn4oZCAvIGkpIH0gZnVuY3Rpb24gbW9kKGQsIGkpIHsgcmV0dXJuIGQgLSB+fihkIC8gaSkgKiBpIH1cblxuICAgIHZhciBzeW5jQ2FsZW5kYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBpbnB1dFZhbHVlID0gZml4RGF0ZShpbnB1dEVsZW1lbnQudmFsKCkpO1xuICAgICAgICBpZiAoaW5wdXRWYWx1ZSA9PT0gXCJcIilcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBpbnB1dFZhbHVlID0gaW5wdXRWYWx1ZS5zcGxpdChcIi9cIik7XG4gICAgICAgIG1vbnRoRHJvcGRvd24udmFsKHBhcnNlSW50KGlucHV0VmFsdWVbMV0pKTtcbiAgICAgICAgbW9udGhEcm9wZG93bi50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICB5ZWFyRHJvcGRvd24udmFsKHBhcnNlSW50KGlucHV0VmFsdWVbMF0pKTtcbiAgICAgICAgeWVhckRyb3Bkb3duLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuaGlnaGxpZ2h0U2VsZWN0ZWREYXkpIHtcbiAgICAgICAgICAgIG1haW5EaXYuZmluZChcIi5iZC1zZWxlY3RlZC1kYXlcIikucmVtb3ZlQ2xhc3MoXCJiZC1zZWxlY3RlZC1kYXlcIik7XG4gICAgICAgICAgICBtYWluRGl2LmZpbmQoXCIuZGF5LVwiICsgcGFyc2VJbnQoaW5wdXRWYWx1ZVsyXSkpLmFkZENsYXNzKFwiYmQtc2VsZWN0ZWQtZGF5XCIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGZpeERhdGUgPSBmdW5jdGlvbiAoZGF0ZSkge1xuICAgICAgICBpZiAoZGF0ZSA9PT0gXCJcIilcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xuXG4gICAgICAgIGRhdGUgPSBkYXRlLnNwbGl0KFwiL1wiKTtcbiAgICAgICAgLy8gaWYgKGRhdGVbMF0ubGVuZ3RoID09PSAyKSB7XG4gICAgICAgIC8vICAgICBkYXRlWzBdID0gXCIxM1wiICsgZGF0ZVswXTtcbiAgICAgICAgLy8gfVxuICAgICAgICBpZiAoZGF0ZVsxXS5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICBpZiAoZGF0ZVsxXSA8IDEwKSB7XG4gICAgICAgICAgICAgICAgZGF0ZVsxXSA9IFwiMFwiICsgZGF0ZVsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0ZVsyXS5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICBpZiAoZGF0ZVsyXSA8IDEwKSB7XG4gICAgICAgICAgICAgICAgZGF0ZVsyXSA9IFwiMFwiICsgZGF0ZVsyXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBkYXRlID0gZGF0ZS5qb2luKFwiL1wiKTtcbiAgICAgICAgcmV0dXJuIGRhdGU7XG4gICAgfVxuXG4gICAgdmFyIGNvbnZlcnRUb0pXZWVrID0gZnVuY3Rpb24gKGRheU9mV2Vla0cpIHtcbiAgICAgICAgdmFyIGRheU9mV2Vla0o7XG4gICAgICAgIGlmIChkYXlPZldlZWtHIDwgNikge1xuICAgICAgICAgICAgZGF5T2ZXZWVrSiA9IGRheU9mV2Vla0cgKyAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGF5T2ZXZWVrSiA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRheU9mV2Vla0o7XG4gICAgfVxuXG4gICAgdmFyIG1ha2VZZWFyTGlzdCA9IGZ1bmN0aW9uICh0aGlzWWVhcikge1xuICAgICAgICB5ZWFyRHJvcGRvd24uZmluZCgnb3B0aW9uJykucmVtb3ZlKCk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCAxMDE7IGkrKykge1xuICAgICAgICAgICAgdmFyIHRlbXBZZWFyID0gKCh0aGlzWWVhciAtIDk1KSArIGkpICsgJyc7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5mb3JjZUZhcnNpRGlnaXRzKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCAxMDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZ3ggPSBuZXcgUmVnRXhwKGosICdnJyk7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBZZWFyID0gdGVtcFllYXIucmVwbGFjZShyZ3gsIEZBX05VTVNbal0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHllYXJEcm9wZG93bi5hcHBlbmQoJCgnPG9wdGlvbj4nLCB7XG4gICAgICAgICAgICAgICAgdmFsdWU6ICh0aGlzWWVhciAtIDk1KSArIGksXG4gICAgICAgICAgICAgICAgdGV4dDogdGVtcFllYXJcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGlzbGVhcCBjYWxjdWxhdG9yLCBzdXBwb3J0ZWQgeWVhcjogMTI0MyAtIDE0NzNcbiAgICB2YXIgaXNMZWFwWWVhciA9IGZ1bmN0aW9uICh5ZWFyKSB7XG4gICAgICAgIHZhciBtb2Q7XG4gICAgICAgIGlmICh5ZWFyIDwgMTM0MyAmJiB5ZWFyID4gMTI0Mykge1xuICAgICAgICAgICAgbW9kID0geWVhciAlIDMzO1xuICAgICAgICAgICAgaWYgKG1vZCA9PSAxIHx8IG1vZCA9PSA1IHx8IG1vZCA9PSA5IHx8IG1vZCA9PSAxMyB8fCBtb2QgPT0gMTcgfHwgbW9kID09IDIyIHx8IG1vZCA9PSAyNiB8fCBtb2QgPT0gMzApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHllYXIgPCAxNDczICYmIHllYXIgPiAxMzQyKSB7XG4gICAgICAgICAgICBtb2QgPSB5ZWFyICUgMTc7XG4gICAgICAgICAgICBpZiAobW9kID09IDEgfHwgbW9kID09IDUgfHwgbW9kID09IDkgfHwgbW9kID09IDEzIHx8IG1vZCA9PSAxOCB8fCBtb2QgPT0gMjIgfHwgbW9kID09IDI2IHx8IG1vZCA9PSAzMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBcInVua25vd25cIjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciBtb250aERheXMgPSBmdW5jdGlvbiAoeWVhciwgbW9udGgpIHtcbiAgICAgICAgaWYgKG1vbnRoIDwgNykge1xuICAgICAgICAgICAgcmV0dXJuIDMxO1xuICAgICAgICB9IGVsc2UgaWYgKG1vbnRoIDwgMTIpIHtcbiAgICAgICAgICAgIHJldHVybiAzMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChpc0xlYXBZZWFyKHllYXIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDMwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMjk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBtYWtlIGZpcnN0IHBhZ2Ugb2YgY2FsZW5kYXJcbiAgICB0b2RheUcgPSBuZXcgRGF0ZSgpO1xuXG4gICAgdG9kYXlzSiA9IGdyZWdvcmlhblRvSmFsYWxpKHRvZGF5Ry5nZXRGdWxsWWVhcigpLCB0b2RheUcuZ2V0TW9udGgoKSArIDEsIHRvZGF5Ry5nZXREYXRlKCkpO1xuICAgIHZhciBzZWxlY3RlZERhdGVKID0gW107XG4gICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgICBzZWxlY3RlZERhdGVKW2ldID0gdG9kYXlzSltpXTtcbiAgICB9XG5cbiAgICB0b2RheXNZZWFyID0gdG9kYXlzSlswXTtcbiAgICB0b2RheXNNb250aCA9IHRvZGF5c0pbMV07XG4gICAgdG9kYXlzRGF5ID0gdG9kYXlzSlsyXTtcblxuICAgIHNlbGVjdGVkWWVhciA9IHNlbGVjdGVkRGF0ZUpbMF07XG4gICAgc2VsZWN0ZWRNb250aCA9IHNlbGVjdGVkRGF0ZUpbMV07XG4gICAgc2VsZWN0ZWREYXkgPSBzZWxlY3RlZERhdGVKWzJdO1xuXG4gICAgbW9udGhEcm9wZG93bi52YWwoc2VsZWN0ZWRNb250aCk7XG4gICAgbWFrZVllYXJMaXN0KHNlbGVjdGVkWWVhcik7XG4gICAgeWVhckRyb3Bkb3duLnZhbChzZWxlY3RlZFllYXIpO1xuXG4gICAgbnVtYmVyT2ZEYXlzID0gbW9udGhEYXlzKHNlbGVjdGVkWWVhciwgc2VsZWN0ZWRNb250aCk7XG5cbiAgICAvLyBmaW5kIGZpcnN0IGRheSBvZiBtb250aCBpbiB3ZWVrXG4gICAgdmFyIGZpbmRGaXJzdERheU9mTW9udGggPSBmdW5jdGlvbiAoc2VsZWN0ZWRZZWFyLCBzZWxlY3RlZE1vbnRoKSB7XG4gICAgICAgIHZhciBmaXJzdERheU9mTW9udGhHID0gdG9HcmVnb3JpYW4oc2VsZWN0ZWRZZWFyLCBzZWxlY3RlZE1vbnRoLCAxKTtcbiAgICAgICAgZmlyc3REYXlPZk1vbnRoRyA9IG5ldyBEYXRlKGZpcnN0RGF5T2ZNb250aEcuZ3kgKyBcIi9cIiArIGZpcnN0RGF5T2ZNb250aEcuZ20gKyBcIi9cIiArIGZpcnN0RGF5T2ZNb250aEcuZ2QpO1xuICAgICAgICByZXR1cm4gY29udmVydFRvSldlZWsoZmlyc3REYXlPZk1vbnRoRy5nZXREYXkoKSk7XG4gICAgfVxuICAgIGRheU9mV2Vla0ogPSBmaW5kRmlyc3REYXlPZk1vbnRoKHNlbGVjdGVkWWVhciwgc2VsZWN0ZWRNb250aCk7XG5cbiAgICAvLyBkcmF3IGRheXMgb24gY2FsZW5kYXJcbiAgICB2YXIgZHJhd0RheXMgPSBmdW5jdGlvbiAobnVtYmVyT2ZEYXlzLCBkYXlPZldlZWtKKSB7XG4gICAgICAgIGRheXNUYWJsZS5lbXB0eSgpO1xuICAgICAgICB2YXIgZGF5SW5kZXggPSAxO1xuICAgICAgICB2YXIgcm93SW5kZXggPSAxO1xuICAgICAgICB3aGlsZSAoZGF5SW5kZXggPD0gbnVtYmVyT2ZEYXlzKSB7XG4gICAgICAgICAgICBkYXlzVGFibGUuYXBwZW5kKCQoJzx0cj4nLCB7XG4gICAgICAgICAgICAgICAgY2xhc3M6IFwidHItXCIgKyByb3dJbmRleFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChkYXlJbmRleCA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBqID0gMDtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGogPCBkYXlPZldlZWtKKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiI2JkLXRhYmxlLWRheXMtXCIgKyBlbGVtZW50SUQgKyBcIiAudHItMVwiKS5hcHBlbmQoJCgnPHRkPicsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzczogXCJiZC1lbXB0eS1jZWxsXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpIDwgNyAmJiBkYXlJbmRleCA8PSBudW1iZXJPZkRheXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBURCA9ICc8dGQ+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGJ1dHRvbiBjbGFzcz1cImRheSBkYXktJyArIGRheUluZGV4ICsgJ1wiIHR5cGU9XCJidXR0b25cIj4nICsgKG9wdGlvbnMuZm9yY2VGYXJzaURpZ2l0cyA/IEZBX05VTVNbZGF5SW5kZXhdIDogZGF5SW5kZXgpICsgJzwvYnV0dG9uPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzwvdGQ+JztcblxuICAgICAgICAgICAgICAgICAgICAvLyBtYXJrIHRvZGF5cyBkYXkgYnkgYWRkaW5nIC5iZC10b2RheSBjbGFzc1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tYXJrVG9kYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXlJbmRleCA9PSB0b2RheXNEYXkgJiYgdG9kYXlzTW9udGggPT0gc2VsZWN0ZWRNb250aCAmJiB0b2RheXNZZWFyID09IHNlbGVjdGVkWWVhcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSB0ZW1wVEQuaW5kZXhPZignZGF5IGRheS0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wVEQgPSB0ZW1wVEQuc2xpY2UoMCwgaWR4KSArICcgYmQtdG9kYXkgJyArIHRlbXBURC5zbGljZShpZHgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gbWFyayBob2xpZGF5cyBieSBhZGRpbmcgLmJkLWhvbGlkYXkgY2xhc3NcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubWFya0hvbGlkYXlzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PSA2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IHRlbXBURC5pbmRleE9mKCdkYXkgZGF5LScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBURCA9IHRlbXBURC5zbGljZSgwLCBpZHgpICsgJyBiZC1ob2xpZGF5ICcgKyB0ZW1wVEQuc2xpY2UoaWR4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICQoXCIjYmQtdGFibGUtZGF5cy1cIiArIGVsZW1lbnRJRCArIFwiIC50ci1cIiArIHJvd0luZGV4KS5hcHBlbmQodGVtcFREKTtcblxuICAgICAgICAgICAgICAgICAgICBkYXlJbmRleCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJvd0luZGV4Kys7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5oaWdobGlnaHRTZWxlY3RlZERheSkge1xuICAgICAgICAgICAgdmFyIGlucHV0VmFsdWUgPSBpbnB1dEVsZW1lbnQudmFsKCk7XG4gICAgICAgICAgICBpbnB1dFZhbHVlID0gaW5wdXRWYWx1ZS5zcGxpdChcIi9cIik7XG4gICAgICAgICAgICBpZiAoaW5wdXRWYWx1ZVswXSA9PSBzZWxlY3RlZFllYXIgJiYgaW5wdXRWYWx1ZVsxXSA9PSBzZWxlY3RlZE1vbnRoKSB7XG4gICAgICAgICAgICAgICAgbWFpbkRpdi5maW5kKFwiLmJkLXNlbGVjdGVkLWRheVwiKS5yZW1vdmVDbGFzcyhcImJkLXNlbGVjdGVkLWRheVwiKTtcbiAgICAgICAgICAgICAgICBtYWluRGl2LmZpbmQoXCIuZGF5LVwiICsgcGFyc2VJbnQoaW5wdXRWYWx1ZVsyXSkpLmFkZENsYXNzKFwiYmQtc2VsZWN0ZWQtZGF5XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBpbnB1dEVsZW1lbnQucGFyZW50KCkub24oXCJjbGlja1wiLCBcImJ1dHRvbi5kYXlcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZGF0ZXN0ciA9IHNlbGVjdGVkWWVhciArIFwiL1wiICsgc2VsZWN0ZWRNb250aCArIFwiL1wiICsgJCh0aGlzKS5hdHRyKCdjbGFzcycpLnNwbGl0KFwiIFwiKVskKHRoaXMpLmF0dHIoJ2NsYXNzJykuc3BsaXQoXCIgXCIpLmluZGV4T2YoJ2RheScpICsgMV0uc3BsaXQoXCItXCIpWzFdO1xuICAgICAgICBpZiAob3B0aW9ucy50d29kaWdpdCkge1xuICAgICAgICAgICAgZGF0ZXN0ciA9IGZpeERhdGUoZGF0ZXN0cik7XG4gICAgICAgIH1cbiAgICAgICAgaW5wdXRFbGVtZW50LnZhbChkYXRlc3RyKTtcbiAgICAgICAgaW5wdXRFbGVtZW50LnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgIGlmIChvcHRpb25zLmNsb3NlQWZ0ZXJTZWxlY3QpIHtcbiAgICAgICAgICAgIGlzQ2FsQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgaW5wdXRFbGVtZW50LnRyaWdnZXIoXCJibHVyXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuaGlnaGxpZ2h0U2VsZWN0ZWREYXkpIHtcbiAgICAgICAgICAgIG1haW5EaXYuZmluZChcIi5iZC1zZWxlY3RlZC1kYXlcIikucmVtb3ZlQ2xhc3MoXCJiZC1zZWxlY3RlZC1kYXlcIik7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwiYmQtc2VsZWN0ZWQtZGF5XCIpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBuZXh0TW9udGgub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJtb250aDogXCIgKyBzZWxlY3RlZE1vbnRoICsgXCIsIHllYXI6IFwiICsgc2VsZWN0ZWRZZWFyKTtcbiAgICAgICAgaWYgKG1vbnRoRHJvcGRvd24udmFsKCkgPCAxMikge1xuICAgICAgICAgICAgbW9udGhEcm9wZG93bi52YWwocGFyc2VJbnQobW9udGhEcm9wZG93bi52YWwoKSkgKyAxKTtcbiAgICAgICAgICAgIG1vbnRoRHJvcGRvd24udHJpZ2dlcihcImNoYW5nZVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1vbnRoRHJvcGRvd24udmFsKDEpO1xuICAgICAgICAgICAgbW9udGhEcm9wZG93bi50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICAgICAgeWVhckRyb3Bkb3duLnZhbChwYXJzZUludCh5ZWFyRHJvcGRvd24udmFsKCkpICsgMSk7XG4gICAgICAgICAgICB5ZWFyRHJvcGRvd24udHJpZ2dlcihcImNoYW5nZVwiKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcHJldk1vbnRoLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAobW9udGhEcm9wZG93bi52YWwoKSA+IDEpIHtcbiAgICAgICAgICAgIG1vbnRoRHJvcGRvd24udmFsKHBhcnNlSW50KG1vbnRoRHJvcGRvd24udmFsKCkpIC0gMSk7XG4gICAgICAgICAgICBtb250aERyb3Bkb3duLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtb250aERyb3Bkb3duLnZhbCgxMik7XG4gICAgICAgICAgICBtb250aERyb3Bkb3duLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgICAgICB5ZWFyRHJvcGRvd24udmFsKHBhcnNlSW50KHllYXJEcm9wZG93bi52YWwoKSkgLSAxKTtcbiAgICAgICAgICAgIHllYXJEcm9wZG93bi50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAob3B0aW9ucy5nb3RvVG9kYXkpIHtcbiAgICAgICAgZ290b1RvZGF5Lm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbW9udGhEcm9wZG93bi52YWwodG9kYXlzTW9udGgpO1xuICAgICAgICAgICAgbW9udGhEcm9wZG93bi50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICAgICAgeWVhckRyb3Bkb3duLnZhbCh0b2RheXNZZWFyKTtcbiAgICAgICAgICAgIHllYXJEcm9wZG93bi50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBkcmF3RGF5cyhudW1iZXJPZkRheXMsIGRheU9mV2Vla0opO1xuXG4gICAgLy8gZW5hYmxlIGJvb3RzdHJhcCB0b29sdGlwIGlmIGJvb3RzdHJhcCBpcyBsb2FkZWRcbiAgICBpZiAodHlwZW9mICQoKS5tb2RhbCA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICQoJ1tkYXRhLXRvZ2dsZT1cInRvb2x0aXBcIl0nKS50b29sdGlwKCk7XG4gICAgfVxuXG59XG4iLCJ2YXIgbWVkaWFfeG0gPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDU3NS45OHB4KVwiKTtcbnZhciBtZWRpYV9zbSA9IHdpbmRvdy5tYXRjaE1lZGlhKFwiKG1pbi13aWR0aDogNTc2cHgpIGFuZCAobWF4LXdpZHRoOiA3NjcuOThweClcIik7XG52YXIgbWVkaWFfbWQgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtaW4td2lkdGg6IDc2OHB4KSBhbmQgKG1heC13aWR0aDogOTkxLjk4cHgpXCIpO1xudmFyIG1lZGlhX2xnID0gd2luZG93Lm1hdGNoTWVkaWEoXCIobWluLXdpZHRoOiA5OTJweCkgYW5kIChtYXgtd2lkdGg6IDExOTkuOThweClcIik7XG52YXIgbWVkaWFfeGwgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtaW4td2lkdGg6IDEyMDBweClcIik7XG5cblxuZnVuY3Rpb24gZXZlbnRfbWVkaWFfeG0obWVkaWEpe1xuXHRpZihtZWRpYS5tYXRjaGVzKSByZXR1cm4gJChkb2N1bWVudCkudHJpZ2dlcignbWVkaWE6eG0nLCBbbWVkaWFdKTtcblx0ZWxzZSByZXR1cm4gJChkb2N1bWVudCkudHJpZ2dlcignbWVkaWE6eG06ZXhpdCcsIFttZWRpYV0pO1xufVxuZnVuY3Rpb24gZXZlbnRfbWVkaWFfc20obWVkaWEpe1xuXHRpZihtZWRpYS5tYXRjaGVzKSByZXR1cm4gJChkb2N1bWVudCkudHJpZ2dlcignbWVkaWE6c20nLCBbbWVkaWFdKTtcblx0ZWxzZSByZXR1cm4gJChkb2N1bWVudCkudHJpZ2dlcignbWVkaWE6c206ZXhpdCcsIFttZWRpYV0pO1xufVxuZnVuY3Rpb24gZXZlbnRfbWVkaWFfbWQobWVkaWEpe1xuXHRpZihtZWRpYS5tYXRjaGVzKSByZXR1cm4gJChkb2N1bWVudCkudHJpZ2dlcignbWVkaWE6bWQnLCBbbWVkaWFdKTtcblx0ZWxzZSByZXR1cm4gJChkb2N1bWVudCkudHJpZ2dlcignbWVkaWE6bWQ6ZXhpdCcsIFttZWRpYV0pO1xufVxuZnVuY3Rpb24gZXZlbnRfbWVkaWFfbGcobWVkaWEpe1xuXHRpZihtZWRpYS5tYXRjaGVzKSByZXR1cm4gJChkb2N1bWVudCkudHJpZ2dlcignbWVkaWE6bGcnLCBbbWVkaWFdKTtcblx0ZWxzZSByZXR1cm4gJChkb2N1bWVudCkudHJpZ2dlcignbWVkaWE6bGc6ZXhpdCcsIFttZWRpYV0pO1xufVxuZnVuY3Rpb24gZXZlbnRfbWVkaWFfeGwobWVkaWEpe1xuXHRpZihtZWRpYS5tYXRjaGVzKSByZXR1cm4gJChkb2N1bWVudCkudHJpZ2dlcignbWVkaWE6eGwnLCBbbWVkaWFdKTtcblx0ZWxzZSByZXR1cm4gJChkb2N1bWVudCkudHJpZ2dlcignbWVkaWE6eGw6ZXhpdCcsIFttZWRpYV0pO1xufVxuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xuXHRldmVudF9tZWRpYV94bShtZWRpYV94bSk7XG5cdG1lZGlhX3htLmFkZExpc3RlbmVyKGV2ZW50X21lZGlhX3htKTtcblxuXHRldmVudF9tZWRpYV9zbShtZWRpYV9zbSk7XG5cdG1lZGlhX3NtLmFkZExpc3RlbmVyKGV2ZW50X21lZGlhX3NtKTtcblxuXHRldmVudF9tZWRpYV9tZChtZWRpYV9tZCk7XG5cdG1lZGlhX21kLmFkZExpc3RlbmVyKGV2ZW50X21lZGlhX21kKTtcblxuXHRldmVudF9tZWRpYV9sZyhtZWRpYV9sZyk7XG5cdG1lZGlhX2xnLmFkZExpc3RlbmVyKGV2ZW50X21lZGlhX2xnKTtcblxuXHRldmVudF9tZWRpYV94bChtZWRpYV94bCk7XG5cdG1lZGlhX3hsLmFkZExpc3RlbmVyKGV2ZW50X21lZGlhX3hsKTtcbn0pXG4iLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG5cdCQoZG9jdW1lbnQpLnRyaWdnZXIoJ3N0YXRpbzpnbG9iYWw6cmVuZGVyUmVzcG9uc2UnLCBbJChkb2N1bWVudCldKTtcbn0pO1xuJCgnW2RhdGEtTGlqYXhdLCAubGlqYXgnLCB0aGlzKS5lYWNoKGZ1bmN0aW9uICgpIHtcblx0bmV3IExpamF4KHRoaXMpO1xufSk7XG4kKFwiYVwiLCB0aGlzKS5ub3QoJy5kaXJlY3QsIFtkYXRhLWRpcmVjdF0sIFt0YXJnZXQ9X2JsYW5rXSwgLmxpamF4LCBbZGF0YS1saWpheF0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cdG5ldyBTdGF0aW8oe1xuXHRcdHVybDogJCh0aGlzKS5hdHRyKCdocmVmJyksXG5cdFx0dHlwZTogJCh0aGlzKS5pcygnLmFjdGlvbicpID8gJ3JlbmRlcicgOiAnYm90aCcsXG5cdFx0Y29udGV4dDogJCh0aGlzKSxcblx0fSk7XG5cdHJldHVybiBmYWxzZTtcbn0pO1xuXG4kKCdmb3JtW2FjdGlvbl0nLCB0aGlzKS5ub3QoJy5kaXJlY3QsIFtkYXRhLWRpcmVjdF0sIFt0YXJnZXQ9X2JsYW5rXSwgLmxpamF4JykuZWFjaChmdW5jdGlvbiAoKSB7XG5cdG5ldyBMaWpheCh0aGlzKTtcbn0pLm9uKCdqcmVzcCcsIGZ1bmN0aW9uIChlLCBkKSB7XG5cdCQoJy5pcy1pbnZhbGlkJywgdGhpcykucmVtb3ZlQ2xhc3MoJ2lzLWludmFsaWQnKTtcblx0JCgnLmludmFsaWQtZmVlZGJhY2snLCB0aGlzKS5yZW1vdmUoKTtcblx0aWYgKGQuZXJyb3JzKSB7XG5cdFx0Zm9yICh2YXIgaWQgaW4gZC5lcnJvcnMpIHtcblx0XHRcdCQoJyMnICsgaWQgKyAnLCBbZGF0YS1hbGlhc349JyArIGlkICsgJ10nKS5hZGRDbGFzcygnaXMtaW52YWxpZCcpO1xuXHRcdFx0JCgnPGRpdiBjbGFzcz1cImludmFsaWQtZmVlZGJhY2tcIj4nICsgZC5lcnJvcnNbaWRdWzBdICsgJzwvZGl2PicpLmluc2VydEFmdGVyKCQoJyMnICsgaWQgKyAnLCBbZGF0YS1hbGlhc349JyArIGlkICsgJ10nKSk7XG5cdFx0fVxuXHR9XG59KTsiLCJmdW5jdGlvbiByZXNwb25zaXZlX21lbnUoKSB7XG4gICAgJCgnI21lbnUnKS5yZW1vdmVDbGFzcygnZC1ub25lJykuYWRkQ2xhc3MoJ2QtZmxleCcpO1xuICAgIC8vICQoJyNkZXNrdG9wJykucmVtb3ZlQ2xhc3MoJ2Qtbm9uZScpO1xuICAgICQoJ2JvZHknKS5hZGRDbGFzcygncmVzcG9uc2l2ZS1tZW51Jyk7XG4gICAgJCgnI2J0bi1tZW51JykuZmluZCgkKFwiLmZhc1wiKSkucmVtb3ZlQ2xhc3MoJ2ZhLWJhcnMnKS5hZGRDbGFzcygnZmEtYXJyb3ctcmlnaHQnKTtcbiAgICAkKHRoaXMpLm9mZignY2xpY2sucmVzcG9uc2l2ZS1tZW51Jyk7XG4gICAgJCh0aGlzKS5vbignY2xpY2suY2xvc2UtcmVzcG9uc2l2ZS1tZW51JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICQodGhpcykub2ZmKCdjbGljay5jbG9zZS1yZXNwb25zaXZlLW1lbnUnKTtcbiAgICAgICAgJCh0aGlzKS5vbignY2xpY2sucmVzcG9uc2l2ZS1tZW51JywgcmVzcG9uc2l2ZV9tZW51KTtcbiAgICAgICAgJCgnI21lbnUnKS5hZGRDbGFzcygnZC1ub25lJykucmVtb3ZlQ2xhc3MoJ2QtZmxleCcpO1xuICAgICAgICAvLyAkKCcjZGVza3RvcCcpLmFkZENsYXNzKCdkLW5vbmUnKTtcbiAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdyZXNwb25zaXZlLW1lbnUnKTtcbiAgICAgICAgJCgnI2J0bi1tZW51JykuZmluZCgkKFwiLmZhc1wiKSkucmVtb3ZlQ2xhc3MoJ2ZhLWFycm93LXJpZ2h0JykuYWRkQ2xhc3MoJ2ZhLWJhcnMnKTtcbiAgICB9KTtcbn1cblxuJChkb2N1bWVudCkub24oJ21lZGlhOnhtIG1lZGlhOnNtJywgZnVuY3Rpb24oZXZlbnQsIG1lZGlhKSB7XG4gICAgJChcImJvZHk6bm90KC5yZXNwb25zaXZlLW1lbnUpICNidG4tbWVudVwiKS5vbignY2xpY2sucmVzcG9uc2l2ZS1tZW51JywgcmVzcG9uc2l2ZV9tZW51KTtcblxuICAgIHZhciBtZW51ID0gJCgnI21lbnUnKTtcbiAgICB2YXIgZGVza3RvcCA9ICQoJyNkZXNrdG9wJyk7XG4gICAgdmFyIGJ0bl9tZW51ID0gJCgnI2J0bi1tZW51Jyk7XG4gICAgJChkb2N1bWVudCkubW91c2V1cChmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgICghbWVudS5pcyhlLnRhcmdldCkgJiYgbWVudS5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgICYmICghZGVza3RvcC5pcyhlLnRhcmdldCkgJiYgZGVza3RvcC5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgICYmICghYnRuX21lbnUuaXMoZS50YXJnZXQpICYmIGJ0bl9tZW51LmhhcyhlLnRhcmdldCkubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgKVxuICAgICAgICB7XG4gICAgICAgICAgICAkKFwiYm9keS5yZXNwb25zaXZlLW1lbnUgI2J0bi1tZW51XCIpLnRyaWdnZXIoJ2NsaWNrLmNsb3NlLXJlc3BvbnNpdmUtbWVudScpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyAkKFwiYm9keVwiKS5zd2lwZSh7XG4gICAgLy8gICAgIHN3aXBlOiBmdW5jdGlvbihldmVudCwgZGlyZWN0aW9uLCBkaXN0YW5jZSwgZHVyYXRpb24sIGZpbmdlckNvdW50LCBmaW5nZXJEYXRhKSB7XG4gICAgLy8gICAgICAgICBpZiAoZGlyZWN0aW9uID09ICdsZWZ0Jykge1xuICAgIC8vICAgICAgICAgICAgICQoXCJib2R5Om5vdCgucmVzcG9uc2l2ZS1tZW51KSAjYnRuLW1lbnVcIikudHJpZ2dlcignY2xpY2sucmVzcG9uc2l2ZS1tZW51Jyk7XG4gICAgLy8gICAgICAgICB9XG5cbiAgICAvLyAgICAgICAgIGlmIChkaXJlY3Rpb24gPT0gJ3JpZ2h0Jykge1xuICAgIC8vICAgICAgICAgICAgICQoXCJib2R5LnJlc3BvbnNpdmUtbWVudSAjYnRuLW1lbnVcIikudHJpZ2dlcignY2xpY2suY2xvc2UtcmVzcG9uc2l2ZS1tZW51Jyk7XG4gICAgLy8gICAgICAgICB9XG5cbiAgICAvLyAgICAgICAgIGlmIChkaXJlY3Rpb24gPT0gJ3VwJyB8fCBkaXJlY3Rpb24gPT0gJ2Rvd24nKSB7XG4gICAgLy8gICAgICAgICAgICAgaWYgKCFtZW51LmlzKGV2ZW50LnRhcmdldCkgJiYgbWVudS5oYXMoZXZlbnQudGFyZ2V0KS5sZW5ndGggPT09IDApIHtcbiAgICAvLyAgICAgICAgICAgICAgICAgJChcImJvZHkucmVzcG9uc2l2ZS1tZW51ICNidG4tbWVudVwiKS50cmlnZ2VyKCdjbGljay5jbG9zZS1yZXNwb25zaXZlLW1lbnUnKTtcbiAgICAvLyAgICAgICAgICAgICB9XG4gICAgLy8gICAgICAgICB9XG4gICAgLy8gICAgIH1cbiAgICAvLyB9KTtcbn0pO1xuXG4kKGRvY3VtZW50KS5vbignbWVkaWE6bWQgbWVkaWE6bGcgbWVkaWE6eGwnLCBmdW5jdGlvbihldmVudCwgbWVkaWEpIHtcbiAgICAkKFwiYm9keS5yZXNwb25zaXZlLW1lbnUgI2J0bi1tZW51XCIpLnRyaWdnZXIoJ2NsaWNrLmNsb3NlLXJlc3BvbnNpdmUtbWVudScpO1xuICAgICQoXCIjYnRuLW1lbnVcIikub2ZmKCdjbGljay5yZXNwb25zaXZlLW1lbnUnKTtcbiAgICAvLyAkKFwiI2J0bi1tZW51XCIpLm9mZignY2xpY2suY2xvc2UtcmVzcG9uc2l2ZS1tZW51Jyk7XG4gICAgLy8gJCgnI21lbnUnKS5hZGRDbGFzcygnZC1ub25lJykucmVtb3ZlQ2xhc3MoJ2QtZmxleCcpO1xuICAgIC8vICQoJyNkZXNrdG9wJykuYWRkQ2xhc3MoJ2Qtbm9uZScpO1xuICAgIC8vICQoJ2JvZHknKS5yZW1vdmVDbGFzcygncmVzcG9uc2l2ZS1tZW51Jyk7XG4gICAgLy8gJCgnI2J0bi1tZW51JykuZmluZCgkKFwiLmZhc1wiKSkucmVtb3ZlQ2xhc3MoJ2ZhLWFycm93LXJpZ2h0JykuYWRkQ2xhc3MoJ2ZhLWJhcnMnKTtcbn0pOyIsIihmdW5jdGlvbiAoKSB7XG5cdGZ1bmN0aW9uIFZpd0ZpbGUoKVxuXHR7XG5cdFx0JCgnLmN1c3RvbS1maWxlLWlucHV0JywgdGhpcykub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCl7XG5cdFx0XHRpZiAoIXdpbmRvdy5GaWxlICYmICF3aW5kb3cuRmlsZVJlYWRlciAmJiAhd2luZG93LkZpbGVMaXN0ICYmICF3aW5kb3cuQmxvYikge1xuXHRcdFx0XHRjb25zb2xlLmVycm9yKCdGaWxlUmVhZGVyIHVuc3VwcG9ydGVkIScpO1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHR2YXIgZmlsZV9pbmRleCA9IDA7XG5cdFx0XHR2YXIgZmlsZTtcblx0XHRcdCQodGhpcykubmV4dCgpLmh0bWwoJycpO1xuXHRcdFx0dmFyIGZpbGVzID0gW107XG5cdFx0XHR3aGlsZSAoZmlsZSA9IHRoaXMuZmlsZXMuaXRlbShmaWxlX2luZGV4KyspKVxuXHRcdFx0e1xuXHRcdFx0XHRmaWxlcy5wdXNoKGZpbGUubmFtZSk7XG5cdFx0XHR9XG5cdFx0XHQkKHRoaXMpLm5leHQoKS5odG1sKGZpbGVzLmpvaW4oJyA6ICcpKTtcblx0XHR9KTtcblx0fVxuXHQkKGRvY3VtZW50KS5vbignc3RhdGlvOmdsb2JhbDpyZW5kZXJSZXNwb25zZScsIGZ1bmN0aW9uIChldmVudCwgYmFzZSwgY29udGV4KSB7XG5cdFx0YmFzZS5lYWNoKGZ1bmN0aW9uICgpIHtcblx0XHRcdFZpd0ZpbGUuY2FsbCh0aGlzKTtcblx0XHR9KTtcblx0fSk7XG5cdFZpd0ZpbGUuY2FsbChkb2N1bWVudCk7XG59KSgpOyJdfQ==
